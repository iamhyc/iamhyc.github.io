<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>å·¥ç¨‹å®è·µ on My Shares and Proofs</title><link>https://sudofree.xyz/categories/practice/</link><description>Recent content in å·¥ç¨‹å®è·µ on My Shares and Proofs</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Tue, 31 Dec 2024 19:00:00 +0800</lastBuildDate><atom:link href="https://sudofree.xyz/categories/practice/index.xml" rel="self" type="application/rss+xml"/><item><title>å¼€å‘æ—¥å¿—ï¼šAigis Authenticator for HarmonyOS NEXT</title><link>https://sudofree.xyz/p/developer-log-aigis-authenticator-for-harmonyos-next/</link><pubDate>Tue, 31 Dec 2024 19:00:00 +0800</pubDate><guid>https://sudofree.xyz/p/developer-log-aigis-authenticator-for-harmonyos-next/</guid><description>&lt;img src="https://sudofree.xyz/p/developer-log-aigis-authenticator-for-harmonyos-next/screenshot-preview.png" alt="Featured image of post å¼€å‘æ—¥å¿—ï¼šAigis Authenticator for HarmonyOS NEXT" />&lt;p>&lt;strong>å‰è¨€ï¼š&lt;/strong> HarmonyOS NEXTçš„ç”Ÿæ€å»ºè®¾çœŸæ˜¯ä¸€ä¸ªå·¨å‘ï¼Œç‰¹åˆ«æ˜¯å¯¹äº ç‹¬ç«‹å¼€å‘è€…ä¸å¼€æºé¡¹ç›® æ¥è¯´ï¼Œæ›´ä¸ç”¨è¯´å…ƒæœåŠ¡é¢å¯¹æ™®é€šåº”ç”¨å¤©ç„¶åŠ£åŠ¿ï¼Œç®€ç›´æ˜¯æ¥è‡ªå®¡æ ¸å’Œç«å“çš„åŒé‡å‹åŠ›ã€‚ä½†æ˜¯æ€€ç€ä¸èƒ½è®©æ–°å…´å¹³å°è¢«ç²—åˆ¶æ»¥é€ çš„åº”ç”¨æ‰€æ·¹æ²¡çš„ä¿¡å¿µï¼Œæˆ‘è¿˜æ˜¯åšæŒæŠŠè¿™ä¸ªé¡¹ç›®çš„ä¸»è¦åŠŸèƒ½å®Œæˆäº†ï¼Œç‰ˆæœ¬å·ä» v0.1.0 æ•°åˆ°äº† v1.0.0ã€‚
ğŸ‰ğŸ‰ğŸ‰ &lt;strong>å®Œç»“æ’’èŠ±&lt;/strong> ğŸ‰ğŸ‰ğŸ‰&lt;/p>
&lt;blockquote>
&lt;p>P.S. æˆªè‡³æœ¬æ–‡ç« å‘å¸ƒæ—¶ï¼ŒAigis Authenticator v1.0.0 ä»åœ¨å®¡æ ¸ä¸­ï¼Œè™½ç„¶æ—©äº12æœˆ27æ—¥ä¸Šåˆæäº¤å®¡æ ¸ï¼Œä½†å¤§æ¦‚è¦è¢«æ‹–åˆ°2025å¹´äº† ğŸ˜…&lt;/p>
&lt;/blockquote>
&lt;h2 id="é¡¹ç›®ç®€ä»‹">&lt;a href="#%e9%a1%b9%e7%9b%ae%e7%ae%80%e4%bb%8b" class="header-anchor">&lt;/a>é¡¹ç›®ç®€ä»‹
&lt;/h2>&lt;p>Aigis æ˜¯ä¸€ä¸ªæœåŠ¡äº HarmonyOS NEXT çš„ 2FA è®¤è¯å…ƒæœåŠ¡ï¼Œé‡‡ç”¨çº¯ ArkTS å®ç°ï¼Œæ— ä»»ä½•ä¸‰æ–¹ä¾èµ–ã€‚&lt;/p>
&lt;p>Aigis çš„ç›®æ ‡æ˜¯æˆä¸ºå®‰å“å¹³å° &lt;a class="link" href="https://github.com/beemdevelopment/Aegis" target="_blank" rel="noopener"
>Aegis Authenticator&lt;/a> çš„è½»é‡çº§æ›¿ä»£å“ã€‚å½“å‰ï¼Œå‡­å€Ÿä¸åˆ° 300KB çš„å®‰è£…åŒ…å¤§å°ï¼ŒAigis å·²å®ç°äº†å…¶è¶…è¿‡ 90% çš„åŠŸèƒ½ï¼Œä¸”å®ç°äº†å­˜å‚¨æ•°æ®æ ¼å¼çš„å®Œæ•´å…¼å®¹ï¼Œå¯ä»¥æ”¯æŒåŠ å¯†å¤‡ä»½æ–‡ä»¶çš„ç›¸äº’å¯¼å…¥å¯¼å‡ºã€‚åŒæ—¶ï¼ŒAigis ä¹Ÿåœ¨è®¾è®¡ä¸Šåšäº†ä¸€äº›æ”¹è¿›ï¼Œæä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œæ•°æ®å®‰å…¨æ€§ã€‚&lt;/p>
&lt;h3 id="å¼€å‘åŠ¨æœº">&lt;a href="#%e5%bc%80%e5%8f%91%e5%8a%a8%e6%9c%ba" class="header-anchor">&lt;/a>å¼€å‘åŠ¨æœº
&lt;/h3>&lt;p>æˆ‘åœ¨ 2024å¹´9æœˆ å‡çº§åˆ° HarmonyOS NEXT beta ç‰ˆæœ¬åï¼Œè¢«è¿«æ”¾å¼ƒäº†å¤§é‡å®‰å“è½¯ä»¶ï¼Œä»¥åŠå¿å—å„ç§æœ‰ç¼ºé™·çš„åº”ç”¨åŠŸèƒ½ï¼Œä½†è¿˜æ˜¯å‘ç°ä¸€ä¸ªé—®é¢˜ä¸èƒ½è§£å†³ï¼š&lt;strong>æ²¡æœ‰ &lt;a class="link" href="https://github.com/beemdevelopment/Aegis" target="_blank" rel="noopener"
>Aegis Authenticator&lt;/a> çš„æ›¿ä»£å“&lt;/strong>ã€‚&lt;/p>
&lt;p>å½“æ—¶çš„åº”ç”¨å¸‚åœºä¸­ï¼Œåªæœ‰ä¸€ä¸ªå« â€œæ‰‹æœºä»¤ç‰Œâ€ çš„ä¸‘åˆ°çˆ†çš„è½¯ä»¶ï¼ˆç›®å‰ç«Ÿç„¶è¿˜åœ¨æ›´æ–°ï¼è¿˜æ˜¯é‚£ä¹ˆä¸‘ï¼ï¼‰ï¼Œè¿˜ä¸å­˜åœ¨åŒç±»ç«å“&lt;del>è™½ç„¶ä¹‹åå“æ˜“é€šçš„ä¸Šæ¶è¯æ˜å¤§å®¶éƒ½æ˜¯å°ä¸‘ğŸ¤¡&lt;/del>ã€‚åŒæ—¶ï¼Œæˆ‘æœ¬æ¥è®¡åˆ’å¼€å‘ä¸€ä¸ª RetroArch çš„é¸¿è’™å‰ç«¯ï¼Œ&lt;a class="link" href="../retrohos-development-logs-01-migrating-libretro-cores" >Retrohos&lt;/a>ï¼Œæ­£å¥½ç§¯ç´¯ä¸€ä¸‹ GUI çš„å¼€å‘ç»éªŒã€‚äºæ˜¯æˆ‘åœ¨å›½åº†å‡æœŸæœŸé—´ï¼Œå¿«é€Ÿå­¦ä¹ äº†ä¸‹ HarmonyOS NEXT çš„å¼€å‘æ–‡æ¡£ï¼Œå¹¶åœ¨ å‡æœŸç»“æŸå‰ å®Œæˆäº†è¿™ä¸ªé¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½ï¼šOTP è®¡ç®—ä¸å±•ç¤ºåŠŸèƒ½ã€‚åœ¨äº 10æœˆ9æ—¥ æäº¤å¤‡æ¡ˆå®¡æ ¸ï¼Œ10æœˆ15æ—¥ è¿‡å®¡åï¼Œæˆ‘äºå½“æ—¥ä¸Šæ¶äº† Aigis çš„é¦–ä¸ªæµ‹è¯•ç‰ˆæœ¬ã€‚&lt;/p>
&lt;h3 id="è®¾è®¡ç†å¿µ">&lt;a href="#%e8%ae%be%e8%ae%a1%e7%90%86%e5%bf%b5" class="header-anchor">&lt;/a>è®¾è®¡ç†å¿µ
&lt;/h3>&lt;p>Aigis çš„ä¸»ä½“è®¾è®¡è¯­è¨€å‚è€ƒäº†åŸç‰ˆ &lt;a class="link" href="https://github.com/beemdevelopment/Aegis" target="_blank" rel="noopener"
>Aegis Authenticator&lt;/a>ï¼ŒåŒæ—¶å› ä¸ºå…ƒæœåŠ¡çš„å½¢æ€åšå‡ºäº†ä¸€å®šè°ƒæ•´ï¼›ä¸»é¢˜é…è‰²å¤§è‡´å‚è€ƒäº†Aigisã€‚&lt;/p>
&lt;p>&lt;img src="https://sudofree.xyz/p/developer-log-aigis-authenticator-for-harmonyos-next/screenshot-preview.png"
width="2585"
height="1456"
srcset="https://sudofree.xyz/p/developer-log-aigis-authenticator-for-harmonyos-next/screenshot-preview_hu14353459484812509928.png 480w, https://sudofree.xyz/p/developer-log-aigis-authenticator-for-harmonyos-next/screenshot-preview_hu3074629423084389773.png 1024w"
loading="lazy"
alt="Aegis Preview"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="426px"
>&lt;/p>
&lt;p>ä¸»é¡µåˆ—è¡¨æ¡ç›®å‚è€ƒäº†å½“å‰ç³»ç»Ÿåº”ç”¨ &lt;em>é‚®ä»¶&lt;/em> çš„è®¾è®¡ï¼Œç¼–è¾‘é¡µé¢é‡‡ç”¨äº† &lt;a class="link" href="https://github.com/beemdevelopment/Aegis" target="_blank" rel="noopener"
>Aegis Authenticator&lt;/a> çš„å¸ƒå±€æ–¹æ¡ˆã€‚è®¾ç½®é¡µé¡¹æ¡ç›®å‚è€ƒäº†ç³»ç»Ÿ &lt;em>è®¾ç½®&lt;/em> çš„è®¾è®¡ï¼Œä¼˜å…ˆä½¿ç”¨äº†ç³»ç»Ÿæä¾›çš„ç»„ä»¶èŒƒå¼ï¼Œä»¥ä¿è¯ç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>Aigis Authenticator åœ¨è®¾è®¡ä¸­å§‹ç»ˆæŠŠ &lt;strong>å®‰å…¨&lt;/strong> æ”¾åœ¨ç¬¬ä¸€ä½ã€‚&lt;/p>
&lt;p>&lt;img src="https://sudofree.xyz/p/developer-log-aigis-authenticator-for-harmonyos-next/aigis-security-design.png"
width="1847"
height="744"
srcset="https://sudofree.xyz/p/developer-log-aigis-authenticator-for-harmonyos-next/aigis-security-design_hu15700608592237045524.png 480w, https://sudofree.xyz/p/developer-log-aigis-authenticator-for-harmonyos-next/aigis-security-design_hu6614365938437409806.png 1024w"
loading="lazy"
alt="Aigis Security Design"
class="gallery-image"
data-flex-grow="248"
data-flex-basis="595px"
>&lt;/p>
&lt;p>è™½ç„¶ç›¸è¾ƒäºæ™®é€šé¸¿è’™åº”ç”¨ï¼Œå…ƒæœåŠ¡æ— æ³•ä½¿ç”¨ Asset Kit æ•°æ®å­˜å‚¨ï¼Œç³»ç»Ÿå¤‡ä»½ï¼Œäº‘åŒæ­¥ç­‰APIï¼Œä½†è¿™ä¹Ÿä»åŸç†ä¸Šä¿è¯äº†å…ƒæœåŠ¡çš„å®‰å…¨æ€§ï¼šåœ¨æ²¡æœ‰ç½‘ç»œæƒé™çš„å‰æä¸‹ï¼Œé™¤éå¾—åˆ°ç”¨æˆ·çš„è®¸å¯ï¼Œç”¨æˆ·çš„æ•°æ®æ— æ³•ä»åº”ç”¨æ²™ç®±ä¸­é€ƒé€¸ã€‚&lt;/p>
&lt;p>ç›¸å¯¹çš„ï¼Œåœ¨æ•°æ®å­˜å‚¨æ–¹é¢ï¼ŒAigis å‚è€ƒ &lt;a class="link" href="https://github.com/beemdevelopment/Aegis" target="_blank" rel="noopener"
>Aegis Authenticator&lt;/a> çš„è®¾è®¡ï¼Œå°†æ¡ç›®å¯†é’¥å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼ˆç”¨æˆ·é¦–é€‰é¡¹ï¼‰ã€‚åŒæ—¶ï¼Œç”¨æˆ·éœ€è¦è®¾ç½®ä¸»å¯†é’¥ï¼Œå¹¶ç»è¿‡ç»å…¸ PBKDF2 æ´¾ç”Ÿç®—æ³•ï¼Œç”Ÿæˆ AES-256 å¯†é’¥å¹¶ä¿å­˜åœ¨å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼ˆTEEï¼‰ä¸­ï¼Œç”¨äºæ¡ç›®å¯†é’¥çš„åŠ è§£å¯†ä½¿ç”¨ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸€æ•°æ®å®‰å…¨å­˜å‚¨çš„æœºåˆ¶ä¸‹ï¼ŒAigis é€šè¿‡ä»¥ä¸‹çš„ä¸€ç³»åˆ—å®‰å…¨è®¾è®¡ï¼Œä¿è¯ç”¨æˆ·å¯¹æ•°æ®çš„ç»å¯¹æŒæ§ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>æ¡ç›®/å¯†é’¥åˆ†ç¦»å­˜å‚¨&lt;/strong>ï¼šåœ¨ç”¨æˆ·é¦–é€‰é¡¹æ–‡ä»¶ä¸­ï¼Œæ¡ç›®å’Œå¯†é’¥åˆ†åˆ«å­˜å‚¨ï¼Œåªå¯¹å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œå®ç°äº† é¡µé¢æ¸²æŸ“æ•ˆç‡ï¼ˆä»…éœ€æ¡ç›®ï¼‰å’Œ ä»¤ç‰Œè®¡ç®—ï¼ˆéœ€è¦æ¡ç›®+å¯†é’¥ï¼‰çš„å®‰å…¨æ€§ çš„å¹³è¡¡ã€‚åœ¨å¯¼å‡ºå¤‡ä»½æ–‡ä»¶æ—¶ï¼Œæ¡ç›®å’Œå¯†é’¥åˆ†åˆ«ä½¿ç”¨ç‹¬ç«‹çš„å¯†é’¥ææ–™åŠ å¯†ï¼Œè¿›ä¸€æ­¥æå‡äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>åŠ å¯†/è§£å¯†å¯†é’¥åˆ†ç¦»è®¾è®¡&lt;/strong>ï¼šå¾—ç›Šäº HUKS çš„è®¾è®¡ï¼ŒAigis å°†æ´¾ç”Ÿçš„ä¸»å¯†é’¥å­˜å‚¨åœ¨å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼ˆTEEï¼‰ä¸­ï¼Œå¹¶æ ¹æ®ç”¨é€”åˆ†ä¸ºä¸¤ä¸ªå¯†é’¥ï¼šä¸€ä¸ªç”¨äºåŠ å¯†å¯†é’¥ï¼ˆ&lt;code>enc_master_key&lt;/code>ï¼‰ï¼Œä¸éœ€è¦é‰´æƒå³å¯è°ƒç”¨ï¼›å¦ä¸€ä¸ªç”¨äºè§£å¯†å¯†é’¥ï¼ˆ&lt;code>dec_master_key&lt;/code>ï¼‰ï¼Œä¸¥æ ¼é™åˆ¶åœ¨åº”ç”¨ä¸­è°ƒç”¨ï¼Œåœ¨ v2.0.0 ä¹‹åæ”¯æŒåœ¨ ATL3 çº§åˆ«å®‰å…¨éªŒè¯ä¹‹åæ‰å¯ä»¥è°ƒç”¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>åŠ å¯†JSONæ–‡ä»¶å¤‡ä»½&lt;/strong>ï¼šç”¨æˆ·åœ¨è®¾ç½®ä¸»å¯†é’¥åï¼Œå¯ä»¥å¯¼å‡ºåŠ å¯†çš„ JSON æ ¼å¼æ•°æ®æ–‡ä»¶ï¼Œç”¨äºå¤‡ä»½æˆ–è€…è¿ç§»åˆ°å¦ä¸€ Aigis å®ä¾‹ä¸­ã€‚åŒæ—¶ï¼Œç”¨æˆ·å¯åœ¨ PC æˆ–å…¶ä»–è®¾å¤‡ä¸Šï¼Œé€šè¿‡è¾“å…¥ä¸»å¯†é’¥å¹¶è°ƒç”¨ PBKDF2 ç®—æ³•ï¼Œè‡ªç”±è§£å¯†æ•°æ®æ–‡ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç”Ÿç‰©è¯†åˆ«è§£é”&lt;/strong>ï¼šAigis æ”¯æŒ ATL1 çº§åˆ«çš„ç”Ÿç‰©è¯†åˆ«è§£é”åº”ç”¨ç•Œé¢ï¼ŒåŒæ—¶å…è®¸è®¾ç½® é¢éƒ¨/æŒ‡çº¹/PINç  ç”¨äºè§£é”çš„ä¼˜å…ˆçº§ã€‚ä¸ &lt;a class="link" href="https://github.com/beemdevelopment/Aegis" target="_blank" rel="noopener"
>Aegis Authenticator&lt;/a> ä¸åŒçš„æ˜¯ï¼ŒAigis åœ¨æœªè®¾ç½®ä¸»å¯†é’¥æ—¶ä¹Ÿæ”¯æŒå¯ç”¨ç”Ÿç‰©è§£é”ï¼Œè¯¥æƒ…å†µä¸‹æ‚¨çš„å¯†é’¥ä»ä»¥æ˜æ–‡å­˜å‚¨åœ¨åº”ç”¨æ²™ç®±ä¸­ã€‚ä» v2.0.0 å¼€å§‹ï¼ŒAigis å°†æ”¯æŒ ATL3 çº§åˆ«çš„ç”Ÿç‰©è§£é”ï¼Œè¯¥å®‰å…¨æ€§å°†ä¸ &lt;a class="link" href="https://github.com/beemdevelopment/Aegis" target="_blank" rel="noopener"
>Aegis Authenticator&lt;/a> ç”Ÿç‰©è§£é”å®‰å…¨æ€§ç­‰ä»·ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>éšç§çª—å£ä¿æŠ¤&lt;/strong>ï¼šAigis é»˜è®¤ä¸å…è®¸æˆªå±ã€å±å¹•å½•åˆ¶ã€ä»»æ„æ‹–æ‹½å†…å®¹ï¼Œä»¥é¿å…å¯èƒ½çš„ä¸ªäººä¿¡æ¯æ³„éœ²ï¼›å¦ä¸€æ–¹é¢ï¼Œä» v0.8.0 ç‰ˆæœ¬å¼€å§‹ï¼Œç”¨æˆ·åœ¨è®¾ç½®ä¸»å¯†é’¥åï¼Œå¯ä»¥è®¾ç½®ç¦ç”¨éšç§çª—å£ä¿æŠ¤ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æˆªå±ã€‚ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è®¾ç½®ä¸»å¯†é’¥åï¼Œæ¡ç›®çš„äºŒç»´ç åˆ†äº«åŠŸèƒ½å°†ä¼šè¢«è‡ªåŠ¨ç¦ç”¨ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ç‰¹æ€§ä¸€è§ˆ">&lt;a href="#%e7%89%b9%e6%80%a7%e4%b8%80%e8%a7%88" class="header-anchor">&lt;/a>ç‰¹æ€§ä¸€è§ˆ
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>&lt;strong>ä¸»é¡µé¢åˆ—è¡¨ï¼Œæ”¯æŒæ¡ç›®æ‹–æ‹½æ’åºï¼Œæœç´¢ï¼Œç½®é¡¶&lt;/strong>&lt;/p>
&lt;img src="aigis-main-page.png" alt="Main Page" width="60%" />
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç¼–è¾‘é¡µé¢æ”¯æŒ äºŒç»´ç åˆ†äº« æ¡ç›®&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ä»…å½“ä¸»å¯†é’¥æœªè®¾ç½®æ—¶ï¼Œè®¾ç½®ä¸»å¯†é’¥åï¼Œåˆ†äº«åŠŸèƒ½å°†è¢«è‡ªåŠ¨ç¦ç”¨&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>é€šç”¨/å¤–è§‚è®¾ç½®ï¼Œå¯¹é½ &lt;a class="link" href="https://github.com/beemdevelopment/Aegis" target="_blank" rel="noopener"
>Aegis Authenticator&lt;/a> ç•Œé¢å®šåˆ¶éœ€æ±‚&lt;/strong>&lt;/p>
&lt;img src="settings-general-outlook.png" alt="General &amp; Outlook Settings" width="60%" />
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ”¯æŒ Aegis æ ¼å¼å›¾æ ‡åŒ…å¯¼å…¥&lt;/strong>&lt;/p>
&lt;img src="settings-icon-pack.png" alt="Icon Pack Import" width="60%" />
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¸»å¯†é’¥è®¾ç½®ï¼Œå¯†ç å‘¨æœŸæé†’ï¼Œå±å¹•å®‰å…¨ï¼Œç”Ÿç‰©è¯†åˆ«è§£é”&lt;/strong>&lt;/p>
&lt;img src="settings-security.png" alt="Security Options" width="60%" />
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ‰«ç æ”¯æŒ Google Authenticator äºŒç»´ç å¯¼å…¥å¯¼å‡º&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>çº¯ ArkTS å®ç° &lt;code>otpauth-migration&lt;/code> payload Protobuf ç¼–è§£ç &lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ”¯æŒ &lt;a class="link" href="https://github.com/beemdevelopment/Aegis" target="_blank" rel="noopener"
>Aegis Authenticator&lt;/a> åŠ å¯†å¤‡ä»½æ–‡ä»¶å¯¼å…¥å¯¼å‡º&lt;/strong>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="å¼€å‘é¿å‘æŒ‡å—">&lt;a href="#%e5%bc%80%e5%8f%91%e9%81%bf%e5%9d%91%e6%8c%87%e5%8d%97" class="header-anchor">&lt;/a>å¼€å‘é¿å‘æŒ‡å—
&lt;/h2>&lt;blockquote>
&lt;p>ä»¥ä¸‹å†…å®¹ä»…æ¶‰åŠæœ¬äººåœ¨å¼€å‘ Aigis è¿‡ç¨‹ä¸­æ‘¸ç´¢é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶ä¸å…¨é¢ï¼Œä»…ä¾›å‚è€ƒã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="å¼€å‘æ–‡æ¡£çš„è·å–">&lt;a href="#%e5%bc%80%e5%8f%91%e6%96%87%e6%a1%a3%e7%9a%84%e8%8e%b7%e5%8f%96" class="header-anchor">&lt;/a>å¼€å‘æ–‡æ¡£çš„è·å–
&lt;/h3>&lt;p>è™½ç„¶è®ºå›é‡Œå¾ˆå¤šåæ§½å¼€å‘æ–‡æ¡£ä¸å¥½æŸ¥çœ‹ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªAPIçš„ç”¨æ³•è¦è·³è½¬å¥½å‡ ä¸ªé¡µé¢ï¼ˆäº‹å®ä¹Ÿç¡®å®å¦‚æ­¤ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªå¼€å‘æ–‡æ¡£æ˜¯å’Œ &lt;a class="link" href="https://docs.openharmony.cn/pages/v5.0/zh-cn/application-dev/application-dev-guide.md" target="_blank" rel="noopener"
>OpenHarmonyæ–‡æ¡£&lt;/a> ä¿æŒä¸€è‡´çš„ï¼Œæ‰€ä»¥åœ¨æŸ¥çœ‹æ–‡æ¡£æ—¶éœ€è¦åˆ†æ¸…ä¸»æ¬¡ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œ&lt;a class="link" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkui-overview-V5?catalogVersion=V5" target="_blank" rel="noopener"
>æŒ‡å—&lt;/a> å’Œ &lt;a class="link" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkui-overview-V5?catalogVersion=V5" target="_blank" rel="noopener"
>APIå‚è€ƒ&lt;/a>ï¼Œè¿™ä¸¤ä¸ªå’Œ OpenHarmony ä¿æŒä¸€è‡´ï¼Œéšç‰ˆæœ¬å·å‘å¸ƒï¼ˆè™½ç„¶ OpenHarmony ç½‘ç«™åªæ”¾å‡ºäº† 5.0.0 çš„æ–‡æ¡£ï¼Œä½† 5.0.1 (API 13) çš„æ–‡æ¡£åœ¨ &lt;a class="link" href="https://gitee.com/openharmony/docs/tree/OpenHarmony-5.0.1-Release/" target="_blank" rel="noopener"
>giteeä»“åº“&lt;/a> ç¡®å®æ˜¯å­˜åœ¨çš„ï¼‰ã€‚&lt;/p>
&lt;p>å…¶æ¬¡ï¼Œ&lt;a class="link" href="https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-harmonyos-features-V5?catalogVersion=V5" target="_blank" rel="noopener"
>æœ€ä½³å®è·µ&lt;/a> å’Œ &lt;a class="link" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-faqs-V5/faqs-ux-design-V5?catalogVersion=V5" target="_blank" rel="noopener"
>FAQ&lt;/a>ï¼Œè¿™ä¸¤ä¸ªæ˜¯ HarmonyOS NEXT ç‰¹æœ‰çš„æ–‡æ¡£ï¼Œæ›´æ–°é¢‘ç‡ä¼šé«˜ä¸€äº›ï¼ˆä¹Ÿæ²¡é«˜å¤šå°‘ï¼‰ï¼Œä¸»è¦æ˜¯å¯¹å¼€å‘æ–‡æ¡£çš„ç¼ºå¤±éƒ¨åˆ†åšå¿«é€Ÿçš„è¡¥å……ï¼Œä½†å…·ä½“åŠŸèƒ½çš„ç¼ºé™·è§£å†³å’Œç‰¹æ€§ï¼Œç›®å‰æ¥çœ‹è¿˜æ˜¯è¦ç­‰ä¸Šæ¸¸ OpenHarmony å‘ç‰ˆä¹‹åæ‰èƒ½åŒæ­¥ã€‚å¦å¤–ï¼Œ&lt;a class="link" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-roadmap-V5/changelogs-pre-V5?catalogVersion=V5" target="_blank" rel="noopener"
>å˜æ›´é¢„å‘Š&lt;/a> ä¹Ÿæœ‰ä¸€å®šç”¨å¤„ï¼Œä½†æˆ‘æ˜¯çœ‹ä¸€æ¬¡å¤±æœ›ä¸€æ¬¡ï¼Œåæ­£æ˜¯æ²¡ä¿®å¤è¿‡æˆ‘æåˆ°çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨çº¿æ–‡æ¡£é¡µé¢çš„â€œæ™ºèƒ½å®¢æœâ€ä»¥åŠå…¨å±€æœç´¢åŠŸèƒ½ï¼Œä¹Ÿæœ‰ä¸€å®šç”¨å¤„ï¼Œä½†æ˜¯ä¸è¦æŠ±å¤ªå¤§å¸Œæœ›ï¼Œæ¯•ç«Ÿç°åœ¨ç”Ÿæ€è¿˜åœ¨å»ºè®¾ä¸­ï¼Œå¾ˆå¤šé—®é¢˜éƒ½æ˜¯éœ€è¦è‡ªå·±æ‘¸ç´¢ã€‚&lt;/p>
&lt;h3 id="å¤‡æ¡ˆä¸è½¯ä»¶è‘—ä½œæƒ">&lt;a href="#%e5%a4%87%e6%a1%88%e4%b8%8e%e8%bd%af%e4%bb%b6%e8%91%97%e4%bd%9c%e6%9d%83" class="header-anchor">&lt;/a>å¤‡æ¡ˆä¸è½¯ä»¶è‘—ä½œæƒ
&lt;/h3>&lt;p>&lt;strong>å…³äºå¤‡æ¡ˆ&lt;/strong>ï¼šæ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œå•æœº + å…ƒæœåŠ¡ï¼Œå°±ä¸éœ€è¦å¤‡æ¡ˆäº†ï¼›ä½†æ˜¯éœ€è¦å†…ç½®åº”ç”¨å¯åŠ¨æ—¶å¼¹å‡ºçš„â€œç”¨æˆ·åè®®â€å’Œâ€œéšç§åè®®â€ï¼Œå…·ä½“å†…å®¹è¯·å‚è€ƒç°æœ‰åº”ç”¨çš„åè®®ï¼Œä¹Ÿå¯ä»¥æœç´¢è®ºå›é‡Œçš„å¸–å­ï¼Œæœ‰äººåˆ†äº«è¿‡ã€‚å¦‚æœæ˜¯å…¶ä»–æƒ…å†µï¼Œåˆ™ä¸€å®šéœ€è¦å¤‡æ¡ˆï¼Œå»ºè®®åœ¨åº”ç”¨å¯åŠ¨å¼€å‘æ—¶ï¼Œå°±å¼€å§‹å¯åŠ¨è¿™ä¸ªæµç¨‹ï¼›è¿™æ ·åœ¨åº”ç”¨åŸºæœ¬åŠŸèƒ½å®Œæˆæ—¶ï¼Œå¤‡æ¡ˆä¹Ÿå·®ä¸å¤šå®Œæˆå®¡æ ¸äº†ã€‚&lt;/p>
&lt;p>&lt;strong>å…³äºè½¯ä»¶è‘—ä½œæƒ&lt;/strong>ï¼šå…ƒæœåŠ¡ä¸éœ€è¦è½¯ä»¶è‘—ä½œæƒï¼Œåº”ç”¨éœ€è¦è½¯ä»¶è‘—ä½œæƒï¼Œä½†ä¹Ÿå¯ä»¥ç”¨ç”µå­ç‰ˆæƒè¯ä¹¦ä»£æ›¿ï¼›ä¸æƒ³è®©ä»£ç†å…¬å¸èµšé’±ï¼Œå¯ä»¥è‡ªå·±ç”³è¯·ï¼Œä½†æ˜¯æ—¶é—´è¦é•¿ä¸€äº›ã€‚&lt;/p>
&lt;h3 id="å·¥å•ç³»ç»Ÿçš„é‡è¦æ€§">&lt;a href="#%e5%b7%a5%e5%8d%95%e7%b3%bb%e7%bb%9f%e7%9a%84%e9%87%8d%e8%a6%81%e6%80%a7" class="header-anchor">&lt;/a>å·¥å•ç³»ç»Ÿçš„é‡è¦æ€§
&lt;/h3>&lt;p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ç–‘ä¼¼ APIç¼ºé™·/æ–‡æ¡£ç¼ºé™· çš„é—®é¢˜ï¼Œé¦–å…ˆè¯·åœ¨åœ¨å¼€å‘è€…è”ç›Ÿè®ºå›é‡Œæœç´¢ä¸€ä¸‹, çœ‹çœ‹æœ‰æ²¡æœ‰äººé‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>å¦‚æœæ²¡æœ‰çš„è¯ï¼Œå»ºè®®ä¹Ÿä¸è¦å†å‘å¸–äº†ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å¼€å‘è€…è”ç›Ÿçš„å·¥å•ç³»ç»Ÿé‡Œæäº¤å·¥å•ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«çš„å¾—åˆ°å®˜æ–¹çš„å›å¤ã€‚&lt;/p>
&lt;p>è™½ç„¶å·¥å•ç³»ç»Ÿçš„å›å¤ä¹Ÿæ˜¯åƒç¯‡ä¸€å¾‹çš„å®¢æœå¤åˆ¶ç²˜è´´æ–‡æ¡£ï¼Œä½†å¦‚æœé—®é¢˜ç¡®å®å­˜åœ¨çš„è¯ï¼Œè¿˜æ˜¯ä¼šä¸Šå‡åˆ°å¼€å‘å›¢é˜Ÿçš„è§†é‡é‡Œï¼Œæœ‰å¯èƒ½ä¼šå¾—åˆ°è§£å†³ã€‚&lt;/p>
&lt;p>è€Œå¦‚æœæ˜¯å…³äºåº”ç”¨ä¸Šæ¶é‡åˆ°é—®é¢˜ï¼Œåˆ™éœ€è¦åœ¨ AppGalley Connect çš„â€œäº’åŠ¨ä¸­å¿ƒâ€æäº¤å·¥å•ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«çš„å¾—åˆ°å®¡æ ¸äººå‘˜çš„å›å¤ã€‚&lt;/p>
&lt;h3 id="huks-å¯†é’¥ç®¡ç†ä¸ä½¿ç”¨">&lt;a href="#huks-%e5%af%86%e9%92%a5%e7%ae%a1%e7%90%86%e4%b8%8e%e4%bd%bf%e7%94%a8" class="header-anchor">&lt;/a>HUKS å¯†é’¥ç®¡ç†ä¸ä½¿ç”¨
&lt;/h3>&lt;p>HUKS çš„æ–‡æ¡£æ˜¯å­˜åœ¨å„ç§ç¼ºé™·çš„ï¼Œå®ƒåŸºäº&lt;strong>è®¾å¤‡&lt;/strong>æä¾›çš„ TEE æ¥å®ç°ï¼Œèƒ½åŠ›è¾¹ç•Œæ˜¯å’Œè®¾å¤‡é«˜åº¦è€¦åˆçš„ï¼Œä½†æ–‡æ¡£ä¸Šå´æ²¡ä½“ç°è¿™ä¸€ç‚¹ã€‚ç›´æ¥å½±å“å°±æ˜¯ï¼Œæœ‰äº›APIåœ¨æ‰‹æœºç«¯æ ¹æœ¬æ²¡æ³•ç”¨ï¼Œä½†ä»–ä»¬çš„æµ‹è¯•å´æ²¡æœ‰é—®é¢˜ã€‚&lt;/p>
&lt;p>è¿™é‡Œåˆ—ä¸¾ä¸‹æˆ‘ä¸ªäººé‡åˆ°çš„é—®é¢˜ï¼Œè®ºå›ä¸Šçš„ç›¸å…³è®¨è®ºæ˜¯æ¯”è¾ƒå°‘çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>æµ‹è¯•å¯ç”¨çš„&lt;/strong>ï¼šå¯†é’¥å¯¼å…¥ï¼Œå¯†é’¥åˆ é™¤ï¼Œå¯†é’¥è¦†ç›–åˆ›å»ºï¼ŒAES ç›¸å…³åŠ è§£å¯†æ“ä½œï¼Œauthé‰´æƒè®¿é—®ï¼Œæˆ‘è¿™è¾¹è¯•è¿‡éƒ½æ˜¯æ²¡é—®é¢˜çš„ã€‚å¦‚æœ‰éœ€è¦çš„è¯ï¼Œå¯ä»¥å‚è€ƒæˆ‘å°è£…è‡ªç”¨çš„å·¥å…·ç±» &lt;a class="link" href="https://github.com/iamhyc/Aigis/blob/master/entry/src/main/ets/crypto/huksUtils.ets" target="_blank" rel="noopener"
>HUKSUtils&lt;/a>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>HMAC æ–¹æ³•æœ€å¥½ä¸è¦ç”¨&lt;/strong>ï¼Œå…·ä½“æ¥è¯´ï¼Œä¹Ÿå°±æ˜¯ä¸è¦æœŸå¾…å¯ä»¥åœ¨ TEE é‡Œå®ŒæˆåŸºäº SHA1/SHA256 çš„ï¼Œéæ ‡å‡†å¯†é’¥é•¿åº¦ï¼ˆ256bit ä¹‹å¤–ï¼‰çš„ HMAC æ“ä½œï¼›å¦‚æœä½ ä¸ä¿¡çš„è¯ï¼Œå¯ä»¥å†™ä¸ªæµ‹è¯•ç”¨ä¾‹è¯•è¯•ï¼Œå¦‚æœèƒ½ç”¨çš„è¯ä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ä¸€å£° ï¼šï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¯†é’¥æ´¾ç”Ÿæ–¹æ³•ï¼šå¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ï¼&lt;/strong> é¦–å…ˆï¼Œå®ƒåªæœ‰ PBKDF2 æ´¾ç”Ÿç®—æ³•ï¼Œè¿˜ä¸æ˜¯æ ‡å‡†å®ç°ï¼å®ƒçš„æ´¾ç”Ÿå¯†é’¥æ˜¯ä¸èƒ½åœ¨å…¶ä»–è®¾å¤‡ä¸Šé‡å¤ç”Ÿæˆçš„ï¼Œè€Œæ˜¯å’ŒTEEé‡Œçš„AESå¯†é’¥åŠä¸å¯æ§çš„åŠ å¯†å‚æ•°ç›¸å…³ï¼é¸¿è’™ä½¿ç”¨äº†ç§æœ‰çš„æ´¾ç”Ÿç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•çš„å®‰å…¨æ€§å’Œå¯é æ€§éƒ½æ˜¯æœªçŸ¥çš„ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼&lt;/p>
&lt;p>è€ƒè™‘åˆ°å½“å‰ ArkTS è™šæ‹Ÿæœºå¯¹äºåŠ å¯†ç®—æ³•çš„æ•ˆç‡é—®é¢˜ï¼Œæ¨èä½¿ç”¨ openssl ç»‘å®šçš„åŠ å¯†åº“ï¼Œå¦‚ &lt;a class="link" href="https://ohpm.openharmony.cn/#/cn/detail/@ohos-rs%2Fopenssl" target="_blank" rel="noopener"
>@ohos-rs/openssl&lt;/a>ï¼Œæˆ–è€…æˆ‘æ‰‹æ“äº†ä¸€ä¸ª &lt;a class="link" href="https://ohpm.openharmony.cn/#/cn/detail/scrypt" target="_blank" rel="noopener"
>Scrypt&lt;/a> å¯†é’¥æ´¾ç”Ÿç®—æ³•ï¼ˆä»…8KBå¤§å°ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="arkts-è™šæ‹Ÿæœºæ•ˆç‡é—®é¢˜">&lt;a href="#arkts-%e8%99%9a%e6%8b%9f%e6%9c%ba%e6%95%88%e7%8e%87%e9%97%ae%e9%a2%98" class="header-anchor">&lt;/a>ArkTS è™šæ‹Ÿæœºæ•ˆç‡é—®é¢˜
&lt;/h3>&lt;p>æ­£å¦‚ä¸Šé¢æåˆ°çš„ï¼ŒArkTS è™šæ‹Ÿæœºå¯¹äºåŠ å¯†ç®—æ³•çš„æ•ˆç‡é—®é¢˜ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚æ—©åœ¨API 10çš„ç‰ˆæœ¬ï¼Œå°±æœ‰äººåé¦ˆè¿‡ &lt;a class="link" href="https://gitee.com/openharmony-sig/ohos_crypto_js/issues/IAS9PA?from=project-issue" target="_blank" rel="noopener"
>@ohos/crypto-js åŠ è§£å¯†å¡æ­»&lt;/a> çš„é—®é¢˜ï¼Œä½†ç›´åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®˜æ–¹è¿˜æ²¡æœ‰ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>æˆ‘æ›¾ç»åœ¨è®ºå›æå‡ºè¿™ä¸ªé—®é¢˜ï¼Œ&lt;a class="link" href="https://developer.huawei.com/consumer/cn/forum/topic/0207168721096647879" target="_blank" rel="noopener"
>ArkTS è®¡ç®—å¯†é›†ä»»åŠ¡ï¼ˆXORè¿ç®—ï¼‰æ•ˆç‡ä½ä¸‹&lt;/a>ï¼ŒåŒæ—¶ä¹Ÿåœ¨å·¥å•ç³»ç»Ÿæé—®ï¼Œä½†æœ€åçš„ç»“è®ºæ˜¯ï¼Œå¿…é¡»æŠŠç›¸å…³ä»£ç åˆ‡æ¢åˆ° Native å®ç°ï¼ŒAOTå½“å‰æ˜¯æ— æ³•å¯ç”¨çš„ï¼ˆæ›´ä¸ç”¨è¯´JITï¼‰ã€‚&lt;/p>
&lt;p>å¦ä¸€æ–¹é¢ï¼Œåä¸ºä¹Ÿåœ¨æ¨å¹¿ Cangjie ä½œä¸º ArkTS çš„æ¥ç­äººï¼Œä½†ä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼ŒCangjie çš„å®¡ç¾æ¯” TypeScript æˆ–è€… Rust éƒ½å·®è¿œäº†ï¼Œè€Œä¸”å®ƒçš„æ–‡æ¡£ä¹Ÿæ˜¯ä¸€å›¢ç³Ÿï¼ŒAPI ä¹Ÿè¿˜æ²¡æœ‰å’Œ ArkTS ä¿æŒä¸€è‡´ï¼Œè°çˆ±ç”¨è°ç”¨å§ â•®(â•¯â–½â•°)â•­&lt;/p>
&lt;h3 id="å…ƒæœåŠ¡-native-å¼€å‘ä¸-native-æ–¹æ³•è°ƒç”¨">&lt;a href="#%e5%85%83%e6%9c%8d%e5%8a%a1-native-%e5%bc%80%e5%8f%91%e4%b8%8e-native-%e6%96%b9%e6%b3%95%e8%b0%83%e7%94%a8" class="header-anchor">&lt;/a>å…ƒæœåŠ¡ Native å¼€å‘ä¸ Native æ–¹æ³•è°ƒç”¨
&lt;/h3>&lt;p>å…ƒæœåŠ¡æ˜¯ä¸å…è®¸åˆ›å»º Native Module çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½åœ¨ å…ƒæœåŠ¡é¡¹ç›® é‡Œåˆ›å»º/ç¼–è¯‘å« Native ä»£ç çš„ HAR/HSP moduleã€‚ä½†æ˜¯ï¼Œå…ƒæœåŠ¡å¯ä»¥é€šè¿‡å¼•ç”¨ HAR/HSP æ¨¡å—ï¼Œè°ƒç”¨ Native æ–¹æ³• â€¦â€¦ å¾ˆæ˜æ˜¾æ‰€è°“ä¸èƒ½åˆ›å»º Native Moduleåªæ˜¯ DevEco Studio çš„ç¼ºé™·ï¼Œå…ƒæœåŠ¡çš„åœ°ä½ä¹‹ä½å¯è§ä¸€æ–‘ã€‚&lt;/p>
&lt;p>åœ¨å…ƒæœåŠ¡é‡Œè°ƒç”¨ Native æ–¹æ³•ï¼Œéœ€è¦æ³¨æ„ï¼šå¯¹äºå«æœ‰ Native æ¨¡å—çš„ HAR/HSP æ¨¡å—ï¼Œå…ƒæœåŠ¡ä¸èƒ½é€šè¿‡ åœ¨çº¿ æ–¹å¼å¼•ç”¨ï¼Œè€Œéœ€è¦æŠŠå¯¹åº”çš„åº“æ”¾åœ¨æœ¬åœ°ï¼Œç„¶åé€šè¿‡æœ¬åœ°å¼•ç”¨çš„æ–¹å¼æ¥è°ƒç”¨ï¼Œä¸ç„¶ä¼šæ— æ³•æ‰¾åˆ° NAPI æš´éœ²çš„æ–¹æ³•ï¼ŒæŠ¥é”™å¦‚ï¼š&lt;code>the requested module '@normalized:Y&amp;amp;&amp;amp;&amp;amp;libscrypt.so&amp;amp;' does not provide an export name 'parallelROMix' which imported by '&amp;amp;scrypt/src/main/ets/scrypt&amp;amp;2.0.0'&lt;/code>ã€‚
è€Œç¥å¥‡çš„æ˜¯ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œåˆ™å®Œå…¨æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;p>è¿™ä¸ªé—®é¢˜æˆ‘ä¹Ÿæè¿‡å·¥å•äº†ï¼Œå°±æ˜¯åˆ°ç°åœ¨è¿˜æ²¡äººç† ğŸ˜…
&lt;img src="ticket-native-har.png" alt="å·¥å•æˆªå›¾" />&lt;/p>
&lt;h2 id="å¿ƒè·¯å†ç¨‹">&lt;a href="#%e5%bf%83%e8%b7%af%e5%8e%86%e7%a8%8b" class="header-anchor">&lt;/a>å¿ƒè·¯å†ç¨‹
&lt;/h2>&lt;p>è¿™ä¸ªåæ§½éƒ¨åˆ†æ”¾åœ¨æœ€åï¼Œåªæ˜¯æ¥çœ‹æŠ€æœ¯çš„è¯»è€…å¯ä»¥ç›´æ¥è·³è¿‡ã€‚&lt;/p>
&lt;p>2024å¹´12æœˆ31æ—¥å‰ï¼ŒHarmonyOS NEXTçš„ç”Ÿæ€è¿›å±•åªæœ‰ä¸€ä¸ªä¸»æ—‹å¾‹ï¼š&lt;strong>å†²é‡&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;strong>ä¼ä¸šå¼€å‘è€…æ–¹é¢ï¼š&lt;/strong> å…ˆæ˜¯å¨é€¼åˆ©è¯±å¤´éƒ¨å‚å•†ï¼Œåšå‡º99%çš„æ—¥å¸¸åº”ç”¨ï¼›ç„¶åä¸Šæ¶ å“æ˜“é€š/å‡ºå¢ƒæ˜“ å®‰å“è™šæ‹Ÿæœºï¼Œè¡¥é½å‰©ä¸‹çš„å°ä¼—è½¯ä»¶å¢ƒå¤–è½¯ä»¶ã€‚&lt;/p>
&lt;p>&lt;strong>ä¸ªäººå¼€å‘è€…æ–¹é¢ï¼š&lt;/strong> å¼€å‘è€…æ¿€åŠ±è®¡åˆ’ï¼Œæ”¾å‡ºå¤§é‡çº¢åˆ©ï¼Œå¸å¼•å¤§æ•°é‡åº”ç”¨ä¸Šæ¶ï¼ˆå³ä½¿å¤§éƒ¨åˆ†ç²—åˆ¶æ»¥é€ ï¼‰ï¼Œå…ƒæœåŠ¡ä¸Šæ¶ç”šè‡³ä¸éœ€è¦è½¯è‘—å’Œå¤‡æ¡ˆï¼›ç„¶åå†æé«˜é—¨æ§›ï¼ŒæŠŠä¸Šè½¦æ™šçš„æ— æ³•å¼•æµçš„åƒåœ¾å…ƒæœåŠ¡ä¸‹æ¶ï¼Œçœä¸€ç‚¹æ˜¯ä¸€ç‚¹ã€‚å¦ä¸€æ–¹é¢ï¼Œå®˜æ–¹çš„å¼€å‘è€…è”ç›Ÿè®ºå›ç›´åˆ°ä»Šå¤©ä¸ºæ­¢ï¼Œä»ç„¶æœ‰å¤§é‡ç–‘ä¼¼å®˜æ–¹çš„æ°´å†›è´¦å·å¤§é‡å¤åˆ¶ç²˜è´´è‡ªå¯¼è‡ªæ¼”çš„å‘å¸–ï¼ŒæŠŠæ­£å¸¸çš„è™½ç„¶æ¯”è¾ƒå°‘çš„æ­£å¸¸å¼€å‘è€…çš„è®¨è®ºä¸æé—®æ·¹æ²¡ã€‚&lt;/p>
&lt;p>&lt;strong>æ¶ˆè´¹è€…æ–¹é¢ï¼š&lt;/strong> å…ˆæ˜¯å‘æ”¾å„ç§åˆä½œå‚å•†çš„ä¼šå‘˜æœˆå¡/å­£å¡ï¼Œå†æ˜¯ç›´æ¥é€é’±å……è¯è´¹ç”µè´¹äº¤é€šå¡ï¼›æœ€å24å¹´å¿«è¿‡å»äº†ï¼ŒAPI 14 å…ˆæ”¯æŒ Nova 12/13 ç”¨æˆ·å‡çº§éœ€æ±‚ï¼Œèƒ½æ‹‰ä¸€ç‚¹å‡çº§ç‡ç®—ä¸€ç‚¹ã€‚&lt;/p>
&lt;p>å¯ä»¥çœ‹å‡ºï¼Œåä¸ºçš„äººåŠ›å’Œè´¢åŠ›ï¼Œéƒ½èŠ±åœ¨äº†&lt;strong>åœ¨2024å¹´ç»“æŸå‰å®Œæˆ è½¬åŒ–ç‡ ç•™å­˜ç‡ æ´»è·ƒåº¦ KPIä¸Š&lt;/strong>ï¼›è‡³äºç”Ÿæ€çš„è´¨é‡ä»¥åŠåç»­å‘å±•ï¼ŒçœŸä¸å¥½è¯´è¿™æ˜¯å¦ç®—æ­£é¢çš„å½±å“ã€‚&lt;/p>
&lt;p>è¿™ä¸€åˆ‡çš„è¡Œä¸ºå¯¼å‘ï¼Œè®©æˆ‘åœ¨å¼€å‘è¿™ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œä¸æ–­æ„Ÿå—åˆ°æ— åŠ›ä¸è¢«æ­§è§†ã€‚é¦–å…ˆï¼ŒAPI 13/14 çš„æ¨å‡ºï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸ºäº†æœåŠ¡å¤´éƒ¨å‚å•†ï¼ˆæ¯”å¦‚å¾®ä¿¡ï¼‰çš„åé¦ˆï¼ˆAPI 13ï¼‰ï¼Œä»¥åŠæé«˜ç”¨æˆ·çš„å‡çº§ç‡çš„éœ€æ±‚ï¼ˆAPI 14ï¼‰ï¼Œä¸ªäººå¼€å‘è€…åé¦ˆçš„é—®é¢˜å‡ ä¹ä¸èƒ½å¾—åˆ°ä¿®å¤ï¼Œæ¯”å¦‚ HUKS çš„å„ç§æ–‡æ¡£ç¼ºå¤±ä»¥åŠ ArkTS çš„æ•ˆç‡ä½ä¸‹ã€‚&lt;/p>
&lt;p>å…¶æ¬¡ï¼Œå…ƒæœåŠ¡çš„ç”Ÿæ€åœ°ä½å ªå¿§ï¼Œè™½ç„¶å®˜æ–¹ä¸€ç›´åœ¨å¼ºè°ƒå…ƒæœåŠ¡ä¸æ™®é€šåº”ç”¨ä¸€ä½“ä¸¤é¢ï¼Œèƒ½ç»™ç”¨æˆ·å¸¦æ¥æ›´ç‹¬ç‰¹çš„ä½“éªŒï¼Œä½†æˆªè‡³ç›®å‰ä¸ºæ­¢ï¼Œå…ƒæœåŠ¡ç®€ä»‹å†…å®¹ä¸èƒ½è¢«åº”ç”¨å¸‚åœºç´¢å¼•ï¼Œæ›¾ä¸€åº¦&lt;a class="link" href="https://github.com/iamhyc/Aigis/issues/30#issuecomment-2505244270" target="_blank" rel="noopener"
>è¢«ç¦æ­¢ä¸Šæ¶å…¬å¼€æµ‹è¯•&lt;/a>ï¼ˆä¸€ä¸ªå¾ˆå¥½å…è´¹çš„è·æµæ¸ é“ç›´åˆ°è¢«åƒåœ¾å…ƒæœåŠ¡å¼€å‘è€…æ»¥ç”¨ï¼‰ï¼Œä¸èƒ½ä½¿ç”¨é¸¿è’™ç¢°ä¸€ç¢°åˆ†äº«ï¼ˆShareKitï¼‰ï¼Œä¸èƒ½æ¥å…¥æ„å›¾æ¡†æ¶ï¼Œå¡ç‰‡åŠ æ¡ŒAPIå­˜åœ¨ç¼ºé™·ä¸èƒ½è§¦å‘åˆ·æ–°ï¼Œå•†åº—å®¡æ ¸è¢«å…¶ä»–åº”ç”¨æ’é˜Ÿ â€¦â€¦ ç­‰ç­‰è¯¸å¤šé™åˆ¶ï¼Œåªèƒ½çœ‹å‡ºå®˜æ–¹å¯¹å…ƒæœåŠ¡ç”Ÿæ€çš„æ¼ è§†ã€‚
å¤§æ¦‚â€œå¾…åˆ°å±±èŠ±çƒ‚æ¼«æ—¶â€ï¼Œå…ƒæœåŠ¡ä¹Ÿå°±ç®—ä¸ªè‚¥æ–™ç½¢äº†ï¼ŒçœŸä¸çŸ¥é“å‘çš„ 300 å—å…ƒæœåŠ¡ä¼˜æƒ åˆ¸åˆ°åº•è‚¥äº†è°çš„é’±åŒ…ã€‚&lt;/p>
&lt;p>æ€»è€Œè¨€ä¹‹ï¼Œç»å†äº†è¿™ä¹ˆå¤šæ³¢æŠ˜ï¼Œæˆ‘è¿˜æ˜¯å®Œæˆäº†è¿™ä¸ªé¡¹ç›®ã€‚ç­‰è¿™æ³¢æ’’é’±/éª—é’±çš„çƒ­åº¦è¿‡å»ï¼Œå†çœ‹çœ‹é¸¿è’™ç”Ÿæ€çš„æœªæ¥åœ¨å“ªé‡Œå§ï¼Œè‡³å°‘æˆ‘ç°åœ¨å¯¹å®ƒæ˜¯ååˆ†å¤±æœ›çš„ï¼ˆæ‰‹æŒ HUAWEI Pura 70 Pro Plus å…‰ç»‡é“¶ 16+512GB åŸä»·è´­å…¥ç”¨æˆ· ä½œç­” ğŸ˜…ï¼‰ã€‚&lt;/p></description></item><item><title>Retrohos å¼€å‘æ—¥å¿—å…¶ä¸€: ç§»æ¤ Libretro Cores</title><link>https://sudofree.xyz/p/retrohos-development-logs-01-migrating-libretro-cores/</link><pubDate>Sat, 07 Sep 2024 22:14:46 +0800</pubDate><guid>https://sudofree.xyz/p/retrohos-development-logs-01-migrating-libretro-cores/</guid><description>&lt;img src="https://sudofree.xyz/p/retrohos-development-logs-01-migrating-libretro-cores/ppsspp-libretro-core.png" alt="Featured image of post Retrohos å¼€å‘æ—¥å¿—å…¶ä¸€: ç§»æ¤ Libretro Cores" />&lt;p>Retrohos çš„ç›®æ ‡æ˜¯ä½œä¸º OpenHarmony/HarmonyOS ä¸Š RetroArch Frontend çš„å®ç°ä»¥åŠå®Œæˆå„ç¤¾åŒº Emulator æ ¸å¿ƒçš„ç§»æ¤ï¼Œå¹¶åŒæ—¶æ”¯æŒé¸¿è’™æ¡†æ¶å…³äº&lt;strong>åˆ†å¸ƒå¼åº”ç”¨&lt;/strong>çš„æ„¿æ™¯ï¼ˆå¦‚å¤§å±æ˜¾ç¤ºåŒæ—¶æ‰‹æœºä½œä¸ºæ‰‹æŸ„çš„ä½“éªŒï¼‰ã€‚
ç”±äºæœ¬äººä¹‹å‰åªæœ‰ç²—æµ…çš„ Android ç§»åŠ¨ç«¯å¼€å‘ç»éªŒï¼ˆ&lt;a class="link" href="https://github.com/lasso-sustech/AndroidScreenCaster" target="_blank" rel="noopener"
>é€šè¿‡NDKæ§åˆ¶AndroidæŠ•å±&lt;/a>ï¼‰ï¼Œæœ¬æ—¥å¿—ä»…ä½œä¸ºåº”ç”¨å¼€å‘æ¢ç´¢è¿‡ç¨‹ä¸­çš„è®°å½•ï¼Œå¹¶éæœ€ä½³å®ç°ï¼Œä»…ä¾›å‚è€ƒã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯-libretro">&lt;a href="#%e4%bb%80%e4%b9%88%e6%98%af-libretro" class="header-anchor">&lt;/a>ä»€ä¹ˆæ˜¯ Libretro
&lt;/h2>&lt;p>RetroArch æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„æ€€æ—§æ¸¸æˆä¸»æœºè§£å†³æ–¹æ¡ˆã€‚å®ƒæœ¬èº«å¹¶ä¸æä¾›ä»»ä½•ä»¿çœŸå™¨çš„åŠŸèƒ½ &lt;del>åªæ˜¯å¤§è‡ªç„¶çš„æ¬è¿å·¥&lt;/del>ï¼Œåªæ˜¯æä¾›äº†èšåˆç¤¾åŒºä»¿çœŸå™¨ï¼ˆEmulator Coreï¼‰çš„å¹³å°ï¼Œä»¥åŠä¸€ä¸ªé€šç”¨çš„æ¥å…¥æ¥å£å®šä¹‰ &lt;a class="link" href="https://www.libretro.com/index.php/api" target="_blank" rel="noopener"
>Libretro&lt;/a>ã€‚ä»¥ä¸‹ç®€ä»‹ç”Ÿæˆè‡ª ChatGPT :&lt;/p>
&lt;blockquote>
&lt;p>Libretro æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ¸¸æˆæœºæ¨¡æ‹Ÿå™¨æ ¸å¿ƒæ¡†æ¶ï¼Œé€šè¿‡ Libretro APIï¼Œå¯ä»¥å°†æ¸¸æˆæ ¸å¿ƒï¼ˆCoreï¼‰ä¸å‰ç«¯ï¼ˆFrontendï¼‰åˆ†ç¦»ï¼Œå®ç°æ ¸å¿ƒçš„è·¨å¹³å°ç§»æ¤ï¼ŒåŒæ—¶æ”¯æŒå¤šç§å‰ç«¯ï¼Œå¦‚ RetroArchã€Lakka ç­‰ã€‚Libretro æ ¸å¿ƒæ˜¯ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œé€šè¿‡è°ƒç”¨ Libretro APIï¼Œå¯ä»¥å®ç°æ¸¸æˆæ ¸å¿ƒçš„åˆå§‹åŒ–ã€è¾“å…¥è¾“å‡ºã€éŸ³é¢‘è§†é¢‘æ¸²æŸ“ç­‰åŠŸèƒ½ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>Libretro å¾ˆå¥½åœ°å°†æ¨¡æ‹Ÿå™¨çš„æ„æˆåŒºåˆ†å¼€æ¥ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å¿½ç•¥ç°æœ‰å‰ç«¯çš„å®ç°ï¼ˆä»¥åŠå„å¼‚çš„GUIæŠ€æœ¯æ ˆï¼‰ï¼Œä¸“æ³¨äºæ ¸å¿ƒçš„ç§»æ¤ä»¥åŠä¸ç³»ç»Ÿçš„å¯¹æ¥ã€‚å› æ­¤ Retrohos é¡¹ç›®çš„ç›®æ ‡æ˜¯å°†å®ç°ä¸€ä¸ªå…¼å®¹ Libretro API çš„å‰ç«¯ï¼ŒåŒæ—¶ç§»æ¤ç¤¾åŒºçš„ Emulator Coreï¼Œè€Œé RetroArch çš„å®Œæ•´ç§»æ¤ã€‚&lt;/p>
&lt;h2 id="å‡†å¤‡-ndk-ç¯å¢ƒ">&lt;a href="#%e5%87%86%e5%a4%87-ndk-%e7%8e%af%e5%a2%83" class="header-anchor">&lt;/a>å‡†å¤‡ NDK ç¯å¢ƒ
&lt;/h2>&lt;p>ç›®å‰å…³äº OpenHarmony çš„å¼€å‘ï¼Œæœ¬äººæ¨èç›´æ¥ä½¿ç”¨ HarmonyOS å•†ä¸šå‘è¡Œç‰ˆä»¥åŠåä¸ºæä¾›çš„å¼€å‘è€…å†…æµ‹SDKï¼Œè€Œéç¤¾åŒºå¼€æºçš„ OpenHarmony ç‰ˆæœ¬ï¼›è™½ç„¶ä¸¤è€…ç›®å‰å·®å¼‚åº¦ä¸å¤§ï¼ˆHarmonyOS Next Beta1 åŸºäº OpenHarmony 5.0.0.xxï¼‰ï¼Œä½†ç›®å‰å”¯ä¸€å¯ç”¨ä¸”æˆç†Ÿçš„ç”Ÿæ€ç¯å¢ƒåªæœ‰ HarmonyOSï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å¾—ä¸æ¥å—çš„ç°çŠ¶ã€‚
ä½†å¥½åœ¨ OpenHarmony NDK å¼€å‘ä¸ Android ç±»ä¼¼ï¼Œå¹¶ä¸éœ€è¦ä¾èµ–å®˜æ–¹æä¾›çš„IDEï¼ˆDevEco Studioï¼‰ï¼›ä»¥ä¸‹çš„å¼€å‘å†…å®¹å°†ä»¥å‘½ä»¤è¡Œå·¥å…·ä¸ºåŸºç¡€ï¼Œåœ¨ Linux å¹³å°ï¼ˆUbuntu 22.04.3 LTSï¼‰ä¸Šè¿›è¡Œã€‚&lt;/p>
&lt;p>ä»¥å½“å‰æœ€æ–°çš„å®˜æ–¹Linuxç‰ˆæœ¬SDKï¼ˆ&lt;code>5.0.0.800&lt;/code>ï¼‰ä¸ºä¾‹ï¼Œä»¥ä¸‹å‡è®¾ &lt;code>commandline-tools.zip&lt;/code> å‹ç¼©åŒ…å·²ç»ä¸‹è½½å¹¶è§£å‹åˆ° &lt;code>$HOME&lt;/code> ç›®å½•ä¸‹ï¼›ä¸ºäº†æ–¹ä¾¿åŒºåˆ†ç‰ˆæœ¬å·ï¼Œå°†è§£å‹åçš„ç›®å½•é‡æ–°å‘½åä¸º &lt;code>command-line-tools/5.0.0.800&lt;/code>ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»º &lt;code>env.sh&lt;/code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="nb">export&lt;/span> &lt;span class="nv">OHOS_ROOT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/command-line-tools/5.0.3.800
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">SDK_ROOT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$OHOS_ROOT&lt;/span>/sdk/default/openharmony
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## export NDK Path&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">NDK_ROOT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$SDK_ROOT&lt;/span>/native
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$NDK_ROOT&lt;/span>/build-tools/cmake/bin:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$NDK_ROOT&lt;/span>/llvm/bin:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## export OHOS command line tools&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$OHOS_ROOT&lt;/span>/tool/node/bin:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$OHOS_ROOT&lt;/span>/bin:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¹‹ååœ¨ä½¿ç”¨æ—¶ï¼Œåªéœ€æ‰§è¡Œ &lt;code>source env.sh&lt;/code> å³å¯ã€‚è¯¥æ–‡ä»¶ä¸»è¦èµ·åˆ°ä»¥ä¸‹ä½œç”¨ï¼š&lt;/p>
&lt;ul>
&lt;li>è®¾ç½®SDKç›¸å…³ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œå˜é‡åç§°æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿åç»­å¼•ç”¨ï¼›&lt;/li>
&lt;li>&lt;code>$NDK_ROOT&lt;/code> æŒ‡å‘ NDK çš„æ ¹ç›®å½•ï¼Œæ–¹ä¾¿åç»­å¼•ç”¨ç¼–è¯‘é“¾å·¥å…·ï¼Œä»¥åŠé“¾æ¥ &lt;code>sysroot&lt;/code>ï¼›&lt;/li>
&lt;li>&lt;code>$PATH&lt;/code> ä¸­å‰ç½®æ·»åŠ äº† &lt;code>cmake&lt;/code> å’Œ &lt;code>llvm&lt;/code> çš„è·¯å¾„ï¼Œä¼šè¦†ç›–æ‰ç³»ç»Ÿé»˜è®¤çš„ç¼–è¯‘å·¥å…·é“¾ï¼Œ ä»¥ç¡®ä¿ä½¿ç”¨ NDK æä¾›çš„å·¥å…·é“¾ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦å¤–æ ¹æ®&lt;a class="link" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ndk-development-overview-V5" target="_blank" rel="noopener"
>å®˜æ–¹NDKå¼€å‘æ–‡æ¡£&lt;/a>ï¼Œåœ¨è°ƒç”¨ NDK æä¾›çš„ &lt;code>cmake&lt;/code> ç¼–è¯‘æ—¶ï¼Œéœ€è¦ä¼ å…¥ä»¥ä¸‹å‚æ•°ï¼ˆä»¥ &lt;code>aarch64-linux-ohos&lt;/code> ä¸ºä¾‹ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cmake -DOHOS_STL&lt;span class="o">=&lt;/span>c++_shared -DOHOS_ARCH&lt;span class="o">=&lt;/span>arm64-v8a -DOHOS_PLATFORM&lt;span class="o">=&lt;/span>OHOS -DCMAKE_TOOLCHAIN_FILE&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NDK_ROOT&lt;/span>&lt;span class="si">}&lt;/span>/build/cmake/ohos.toolchain.cmake .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…¶ä¸­ &lt;code>CMAKE_TOOLCHAIN_FILE&lt;/code> æœ€ä¸ºé‡è¦ï¼ŒæŒ‡å®šäº†ç¼–è¯‘é“¾çš„é…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¼šè‡ªåŠ¨é“¾æ¥ NDK æä¾›çš„ &lt;code>sysroot&lt;/code>ã€‚&lt;/p>
&lt;h2 id="ç§»æ¤-libretro-æ ¸å¿ƒ">&lt;a href="#%e7%a7%bb%e6%a4%8d-libretro-%e6%a0%b8%e5%bf%83" class="header-anchor">&lt;/a>ç§»æ¤ Libretro æ ¸å¿ƒ
&lt;/h2>&lt;h3 id="libretro-super-ç§»æ¤å°è¯•">&lt;a href="#libretro-super-%e7%a7%bb%e6%a4%8d%e5%b0%9d%e8%af%95" class="header-anchor">&lt;/a>&lt;code>libretro-super&lt;/code> ç§»æ¤å°è¯•
&lt;/h3>&lt;p>&lt;a class="link" href="https://github.com/libretro/libretro-super" target="_blank" rel="noopener"
>&lt;code>libretro/libretro-super&lt;/code>&lt;/a> ä»“åº“æ˜¯ä¸€ä¸ªç”¨äºç®¡ç† Libretro æ ¸å¿ƒä»¥åŠ RetroArch åœ¨ä¸åŒå¹³å°ç¼–è¯‘è„šæœ¬çš„ç®¡ç†é¡¹ç›®ï¼Œå…¶æŒ‰ç…§ &lt;em>target triplet&lt;/em> æ ‡è¯†ä¸ç»„ç»‡ä¸åŒå¹³å°ä¸‹çš„æ„å»ºæµç¨‹ã€‚
æœ€åˆï¼Œæˆ‘ä»¥ä¸º OpenHarmony åº•å±‚ä¸è¿‡æ˜¯ Linux kernel çš„ &lt;code>aarch64&lt;/code> æ¶æ„ï¼Œå·¥å…·é“¾ä¸­çš„åŠ¨æ€åº“ä¹Ÿéƒ½å¾ˆå¸¸è§ï¼Œä¸ SDKå…³ç³»ä¸å¤§ï¼Œå› æ­¤å°è¯•ç›´æ¥ç§»æ¤è¿™ä¸ªè¶…çº§é¡¹ç›®ã€‚ç„¶è€Œå¯æƒœçš„æ˜¯ï¼Œç”±äº &lt;code>ohos&lt;/code> / &lt;code>OHOS&lt;/code> æ ‡è¯†å¹¶éä¼—å¤šä¸Šæ¸¸ä¾èµ–æ”¯æŒçš„å¹³å°ï¼Œå¹¶ä¸”å®ƒä¹Ÿä¸ä¼šè¢«è‡ªåŠ¨é™çº§åˆ° aarch64 Linux çš„æ„å»ºæµç¨‹ä¸­ï¼Œæš´åŠ›ç§»æ¤åªä¼šé™·å…¥åˆ°æ— é™çš„ä¾èµ–è§£å†³ä¸­ã€‚&lt;/p>
&lt;p>å› æ­¤æœ€åˆé€‚çš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ä»…é‡‡ç”¨ Libretro Core çš„æ„å»ºæµç¨‹ï¼ˆé€ä¸ª Fork ä»“åº“è¿›è¡Œä¿®æ”¹ğŸ˜“ï¼‰ï¼ŒæŠ›å¼ƒ &lt;code>libretro-super&lt;/code> è¿™ä¸ªè¿‡äºæ‚ä¹±çš„é¡¹ç›®çš„æ•´ä½“ç§»æ¤ã€‚åœ¨æœ¬é¡¹ç›®çš„å¯åŠ¨é˜¶æ®µï¼Œæˆ‘ä»¬èšç„¦äº ppsspp æ ¸å¿ƒçš„ç§»æ¤ï¼šå®ƒæœ¬èº«æä¾›äº† &lt;code>ppsspp-libretro&lt;/code> çš„åŠ¨æ€åº“æ„å»ºé€‰é¡¹ï¼Œä¸‰æ–¹ä¾èµ–è¾ƒå°‘ï¼Œæ˜¯ç¬¬ä¸€ä¸ªæˆåŠŸæ„å»ºçš„æ ¸å¿ƒã€‚&lt;/p>
&lt;h3 id="ç¼–è¯‘-ppsspp-libretro-æ ¸å¿ƒ">&lt;a href="#%e7%bc%96%e8%af%91-ppsspp-libretro-%e6%a0%b8%e5%bf%83" class="header-anchor">&lt;/a>ç¼–è¯‘ &lt;code>ppsspp-libretro&lt;/code> æ ¸å¿ƒ
&lt;/h3>&lt;h4 id="ppsspp-ffmpeg-é™æ€åº“æ„å»º">&lt;a href="#ppsspp-ffmpeg-%e9%9d%99%e6%80%81%e5%ba%93%e6%9e%84%e5%bb%ba" class="header-anchor">&lt;/a>&lt;code>ppsspp-ffmpeg&lt;/code> é™æ€åº“æ„å»º
&lt;/h4>&lt;p>&lt;a class="link" href="https://github.com/Retrohos/ppsspp" target="_blank" rel="noopener"
>&lt;code>hrydgard/ppsspp&lt;/code>&lt;/a> é€šè¿‡ &lt;code>.gitmodules&lt;/code> å¼•å…¥äº†å¤šä¸ªä¸‰æ–¹ä¾èµ–ï¼Œå…¶ä¸­åªæœ‰å…¶è‡ªå·±ç»´æŠ¤çš„ &lt;code>hrydgard/ppsspp-ffmpeg&lt;/code> éœ€è¦é¢å¤–å¤„ç† &lt;code>OHOS&lt;/code> æ¶æ„å­—ç¬¦ä¸²çš„æ·»åŠ ï¼Œå‚è€ƒ &lt;code>android_arm64_v8a.sh&lt;/code> å¹¶å¯¹åº”æ·»åŠ  &lt;code>ohos_arm64-v8a.sh&lt;/code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$NDK_ROOT&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Please set NDK_ROOT to your OpenHarmony NDK location.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">NDK_PLATFORM&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;aarch64-linux-ohos&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">NDK_PLATFORM_LIB&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$NDK_ROOT&lt;/span>/sysroot/usr/lib/&lt;span class="nv">$NDK_PLATFORM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">NDK_PREBUILTLLVM&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$NDK_ROOT&lt;/span>/llvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> -e
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">GENERAL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-cross-compile \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-pic \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --cc=&lt;/span>&lt;span class="nv">$NDK_PREBUILTLLVM&lt;/span>&lt;span class="s2">/bin/clang \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --cross-prefix=&lt;/span>&lt;span class="nv">$NDK_PREBUILTLLVM&lt;/span>&lt;span class="s2">/bin/aarch64-unknown-linux-ohos- \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --ar=&lt;/span>&lt;span class="nv">$NDK_PREBUILTLLVM&lt;/span>&lt;span class="s2">/bin/llvm-ar \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --ld=&lt;/span>&lt;span class="nv">$NDK_PREBUILTLLVM&lt;/span>&lt;span class="s2">/bin/clang \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --nm=&lt;/span>&lt;span class="nv">$NDK_PREBUILTLLVM&lt;/span>&lt;span class="s2">/bin/llvm-nm \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --ranlib=&lt;/span>&lt;span class="nv">$NDK_PREBUILTLLVM&lt;/span>&lt;span class="s2">/bin/llvm-ranlib&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MODULES&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --disable-avdevice \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --disable-filters \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --disable-programs \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --disable-network \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --disable-avfilter \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --disable-postproc \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --disable-encoders \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --disable-protocols \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --disable-hwaccels \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --disable-doc&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">VIDEO_DECODERS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=h264 \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=mpeg4 \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=mpeg2video \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=mjpeg \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=mjpegb&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">AUDIO_DECODERS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=aac \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=aac_latm \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=atrac3 \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=atrac3p \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=mp3 \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=pcm_s16le \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-decoder=pcm_s8&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">DEMUXERS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=h264 \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=m4v \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=mpegvideo \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=mpegps \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=mp3 \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=avi \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=aac \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=pmp \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=oma \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=pcm_s16le \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=pcm_s8 \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-demuxer=wav&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">VIDEO_ENCODERS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-encoder=huffyuv
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-encoder=ffv1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">AUDIO_ENCODERS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-encoder=pcm_s16le&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MUXERS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-muxer=avi&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">PARSERS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-parser=h264 \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-parser=mpeg4video \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-parser=mpegaudio \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-parser=mpegvideo \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-parser=aac \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> --enable-parser=aac_latm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> build_arm64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># no-missing-prototypes because of a compile error seemingly unique to aarch64.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./configure --logfile&lt;span class="o">=&lt;/span>conflog.txt --target-os&lt;span class="o">=&lt;/span>linux &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --prefix&lt;span class="o">=&lt;/span>./ohos/arm64 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --arch&lt;span class="o">=&lt;/span>aarch64 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">GENERAL&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --extra-cflags&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34; --target=aarch64-linux-ohos -no-canonical-prefixes -fdata-sections -ffunction-sections -fno-limit-debug-info -funwind-tables -fPIC -O2 -DOHOS -DOHOS_ARCH=arm64-v8a -DOHOS_PLATFORM=OHOS -DCMAKE_TOOLCHAIN_FILE=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NDK_ROOT&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">/build/cmake/ohos.toolchain.cmake -Dipv6mr_interface=ipv6mr_ifindex -fasm -fno-short-enums -fno-strict-aliasing -Wno-missing-prototypes&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --disable-shared &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --enable-static &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --extra-ldflags&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34; -B&lt;/span>&lt;span class="nv">$NDK_PREBUILTLLVM&lt;/span>&lt;span class="s2">/bin/aarch64-unknown-linux-ohos- --target=aarch64-linux-ohos -Wl,--rpath-link,&lt;/span>&lt;span class="nv">$NDK_PLATFORM_LIB&lt;/span>&lt;span class="s2"> -L&lt;/span>&lt;span class="nv">$NDK_PLATFORM_LIB&lt;/span>&lt;span class="s2"> -nostdlib -lc -lm -ldl&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --enable-zlib &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --disable-everything &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">MODULES&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">VIDEO_DECODERS&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">AUDIO_DECODERS&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">VIDEO_ENCODERS&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">AUDIO_ENCODERS&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">DEMUXERS&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">MUXERS&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">PARSERS&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make clean
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make -j4 install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">build_arm64
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€šè¿‡ä¹‹å‰æåˆ°çš„ &lt;code>source env.sh&lt;/code> å‡†å¤‡å¥½ NDK ç¯å¢ƒåï¼Œéšåæ‰§è¡Œè¯¥æ„å»ºè„šæœ¬ï¼Œåœ¨ &lt;code>ohos/arm64&lt;/code> ä¸‹ç”Ÿæˆ &lt;code>libavcodec.a&lt;/code> ç­‰é™æ€åº“æ–‡ä»¶ï¼Œä»¥åŠ &lt;code>include&lt;/code> ç›®å½•ä¸‹çš„å¤´æ–‡ä»¶ã€‚
æäº¤ç›¸å…³æ›´æ”¹åï¼Œå³å¯åœ¨ &lt;code>ppsspp-libretro&lt;/code> ä¸­å°† submodule æŒ‡å‘æˆ‘ä»¬ä¿®æ”¹åçš„ä»“åº“ &lt;a class="link" href="https://github.com/Retrohos/ppsspp-ffmpeg.git" target="_blank" rel="noopener"
>&lt;code>Retrohos/ppsspp-ffmpeg&lt;/code>&lt;/a>.&lt;/p>
&lt;h4 id="ppsspp-æ„å»º">&lt;a href="#ppsspp-%e6%9e%84%e5%bb%ba" class="header-anchor">&lt;/a>&lt;code>ppsspp&lt;/code> æ„å»º
&lt;/h4>&lt;p>&lt;code>ppsspp-libretro&lt;/code> æœ¬èº«çš„ç§»æ¤è¾ƒä¸ºç®€å•ï¼Œåªéœ€è¦åœ¨ &lt;code>CMakeLists.txt&lt;/code> ä¸­æ·»åŠ  OHOS æ¶æ„çš„åˆ¤æ–­ï¼Œä»¥åŠä¿®æ”¹ &lt;code>CMakeLists.txt&lt;/code> ä¸­çš„ç¼–è¯‘é€‰é¡¹ï¼Œpatch å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="line">&lt;span class="cl">&lt;span class="gh">diff --git a/CMakeLists.txt b/CMakeLists.txt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gh">index ad2be076b..2fe1e619c 100644
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gh">&lt;/span>&lt;span class="gd">--- a/CMakeLists.txt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+++ b/CMakeLists.txt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span>&lt;span class="gu">@@ -99,8 +99,12 @@ if(${CMAKE_SYSTEM_NAME} MATCHES &amp;#34;Android&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> set(ANDROID ON)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endif()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+if(${CMAKE_SYSTEM_NAME} MATCHES &amp;#34;OHOS&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ set(OHOS ON)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+endif()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> # We only support Vulkan on Unix, macOS (by MoltenVK), Android and Windows.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">-if(ANDROID OR WIN32 OR (UNIX AND NOT ARM_NO_VULKAN))
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+if(OHOS OR ANDROID OR WIN32 OR (UNIX AND NOT ARM_NO_VULKAN))
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> set(VULKAN ON)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endif()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">@@ -192,7 +196,7 @@ if(USE_CCACHE)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> include(ccache)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endif()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">-if(UNIX AND NOT (APPLE OR ANDROID) AND VULKAN)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+if(UNIX AND NOT (APPLE OR ANDROID OR OHOS) AND VULKAN)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> if(USING_X11_VULKAN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> message(&amp;#34;Using X11 for Vulkan&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> find_package(X11)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">@@ -225,7 +229,7 @@ if(LIBRETRO)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> endif()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endif()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">-if(ANDROID)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+if(ANDROID OR OHOS)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> set(MOBILE_DEVICE ON)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set(USING_GLES2 ON)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endif()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">@@ -382,7 +386,7 @@ if(NOT MSVC)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> # NEON optimizations in libpng17 seem to cause PNG load errors, see #14485.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add_definitions(-DPNG_ARM_NEON_OPT=0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- if(ANDROID)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+ if(ANDROID OR OHOS)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> set(CMAKE_CXX_FLAGS &amp;#34;${CMAKE_CXX_FLAGS} -std=gnu++17&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endif()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if(CLANG)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">@@ -474,7 +478,7 @@ if(NOT MSVC)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> if(${CMAKE_SYSTEM_NAME} STREQUAL &amp;#34;NetBSD&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add_definitions(-D_NETBSD_SOURCE)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endif()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- elseif(ANDROID)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+ elseif(ANDROID OR OHOS)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> add_definitions(-fsigned-char)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endif()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> else()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">@@ -943,6 +947,10 @@ if(USE_FFMPEG)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> elseif(X86)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set(PLATFORM_ARCH &amp;#34;android/x86&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endif()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ elseif(OHOS)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ if(ARM64)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ set(PLATFORM_ARCH &amp;#34;ohos/arm64&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ endif()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> elseif(IOS)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if(IOS_PLATFORM STREQUAL &amp;#34;TVOS&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set(PLATFORM_ARCH &amp;#34;tvos/arm64&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">@@ -1200,7 +1208,7 @@ else()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> endif()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Arm platforms require at least libpng17.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">-if(ANDROID OR ARMV7 OR ARM64 OR ARM OR IOS)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+if(OHOS OR ANDROID OR ARMV7 OR ARM64 OR ARM OR IOS)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> set(PNG_REQUIRED_VERSION 1.7)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> else()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set(PNG_REQUIRED_VERSION 1.6)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¿®æ”¹å®Œæˆåæ‰§è¡Œ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cmake -DOHOS_STL&lt;span class="o">=&lt;/span>c++_shared -DOHOS_ARCH&lt;span class="o">=&lt;/span>arm64-v8a -DOHOS_PLATFORM&lt;span class="o">=&lt;/span>OHOS -DCMAKE_TOOLCHAIN_FILE&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">NDK_ROOT&lt;/span>&lt;span class="si">}&lt;/span>/build/cmake/ohos.toolchain.cmake -DLIBRETRO&lt;span class="o">=&lt;/span>ON -DUSING_EGL&lt;span class="o">=&lt;/span>ON -DUSING_GLES2&lt;span class="o">=&lt;/span>ON . -Bbuild
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆ›å»º &lt;code>build&lt;/code> ç›®å½•ï¼Œå¹¶åœ¨å…¶ä¸­æ‰§è¡Œ &lt;code>make -j4&lt;/code> å³å¯ç”Ÿæˆ &lt;code>lib/ppsspp_libretro.so&lt;/code> æ–‡ä»¶ã€‚&lt;/p>
&lt;h2 id="åç»­è®¡åˆ’">&lt;a href="#%e5%90%8e%e7%bb%ad%e8%ae%a1%e5%88%92" class="header-anchor">&lt;/a>åç»­è®¡åˆ’
&lt;/h2>&lt;p>ä½œä¸ºé¡¹ç›®çš„å¯åŠ¨é˜¶æ®µï¼Œä¸€ä¸ªæ ¸å¿ƒçš„ç§»æ¤å·²ç»è¶³å¤Ÿæˆ‘ä»¬è¿›è¡Œåç»­çš„å‰ç«¯å¼€å‘ã€‚æ¥ä¸‹æ¥è®¡åˆ’å…ˆè®¾è®¡ä¸€ä¸ªç®€å•çš„ Libretro å‰ç«¯ï¼Œå¹¶é€šè¿‡ ArkTS NAPI è¿›è¡Œç»‘å®šè°ƒç”¨ï¼Œå¿«é€Ÿå®ç° framebuffer çš„è¾“å‡ºã€‚è‡³äºæ›´ä¸ºé‡è¦çš„ GUI è®¾è®¡ï¼Œå¯ä»¥å†ç­‰ç­‰ DevEco Studio å¼€å‘å¥—ä»¶çš„å®Œå–„(ï½oï¿£3ï¿£)ï½&lt;/p></description></item><item><title>è§£å†³ Gaussian Splatting åŸå§‹å®ç°ä¸­çš„å†…å­˜æ³„æ¼é—®é¢˜</title><link>https://sudofree.xyz/p/solve-memory-leak-in-vanilla-gaussian-splatting-code/</link><pubDate>Mon, 02 Sep 2024 15:43:01 +0800</pubDate><guid>https://sudofree.xyz/p/solve-memory-leak-in-vanilla-gaussian-splatting-code/</guid><description>&lt;img src="https://sudofree.xyz/p/solve-memory-leak-in-vanilla-gaussian-splatting-code/memory-leak.png" alt="Featured image of post è§£å†³ Gaussian Splatting åŸå§‹å®ç°ä¸­çš„å†…å­˜æ³„æ¼é—®é¢˜" />&lt;blockquote>
&lt;p>ä»¥ä¸‹å†…å®¹ä½¿ç”¨ &lt;a class="link" href="deel.com" >deepl.com&lt;/a> æœºç¿»è¾…åŠ©ï¼Œå¦‚æœ‰ä¸é€‚è¯·å‚è€ƒè‹±æ–‡ç‰ˆæœ¬ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æˆ‘å¾ˆå¥‡æ€ªä¸ºä»€ä¹ˆæ²¡æœ‰äººå‘ç°è¿™ä¸ªå†…å­˜æ³„æ¼é—®é¢˜ã€‚ä¹Ÿè®¸æ˜¯æˆ‘å¤ªæ‡’äº†ï¼Œæ²¡æœ‰åœ¨ç½‘ä¸Šç¿»åˆ°ã€‚
æ€»ä¹‹ï¼Œæˆ‘å‘ç°åœ¨åŸå§‹å®ç°ä¸­å­˜åœ¨æ˜æ˜¾çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼ˆå…¶æºä»£ç å¯åœ¨ &lt;a class="link" href="https://github.com/graphdeco-inria/gaussian-splatting" target="_blank" rel="noopener"
>Github&lt;/a> ä¸Šè·å–ï¼‰ã€‚&lt;/p>
&lt;p>æˆ‘åœ¨åŠ è½½ä¸€ä¸ªå¤§å‹æ•°æ®é›†æ—¶å‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œè¯¥æ•°æ®é›†åŒ…å«çº¦ 600 çš„å›¾åƒå’Œ 400 ä¸‡çš„ç‚¹äº‘æ•°æ®ï¼Œè¿™äº›å›¾åƒå’Œç‚¹æ˜¯é€šè¿‡ç²¾ç¡®çš„å‡ ä½•æ˜ å°„æ”¶é›†çš„ã€‚è®­ç»ƒæ—¶å ç”¨äº†NVIDIA RTX 3090 GPU 20GB ä»¥ä¸Šçš„æ˜¾å­˜ï¼ŒåŒæ—¶è¿˜å ç”¨äº† 15GB ä»¥ä¸Šçš„å†…å­˜ã€‚è™½ç„¶åœºæ™¯ç¡®å®å¾ˆå¤§ï¼Œä½†æˆ‘å¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆä¸€å¼€å§‹å°±å ç”¨äº†æ‰€æœ‰å†…å­˜ï¼Œè€Œä¸æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­é€æ¸å¢åŠ ï¼&lt;/p>
&lt;h2 id="ç¬¬ä¸€ä¸ªè¡¥ä¸---å»¶è¿ŸåŠ è½½">&lt;a href="#%e7%ac%ac%e4%b8%80%e4%b8%aa%e8%a1%a5%e4%b8%81---%e5%bb%b6%e8%bf%9f%e5%8a%a0%e8%bd%bd" class="header-anchor">&lt;/a>ç¬¬ä¸€ä¸ªè¡¥ä¸ - å»¶è¿ŸåŠ è½½
&lt;/h2>&lt;p>é¦–å…ˆï¼Œæˆ‘æ‰¾å‡ºäº† CPU å ç”¨å¤§é‡å†…å­˜ï¼ˆå³ RAM å ç”¨ï¼‰çš„åŸå› ï¼šä¸€å¼€å§‹ï¼Œæ‰€æœ‰å›¾åƒçš„éƒ½åœ¨ RAM ä¸­è¢«åŠ è½½ï¼Œå¹¶åœ¨ GPU ä¸Šåˆ›å»ºäº†ç›¸åº”çš„å¼ é‡ã€‚ç›¸å…³æºä»£ç è§ &lt;a class="link" href="https://github.com/graphdeco-inria/gaussian-splatting/blob/main/utils/camera_utils.py#L20" target="_blank" rel="noopener"
>&lt;code>utils/camera_utils.py#L20&lt;/code>&lt;/a>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">loadCam&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cam_info&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">resolution_scale&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">is_test_dataset&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">Camera&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resolution&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">colmap_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cam_info&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">uid&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cam_info&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cam_info&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">FoVx&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cam_info&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">FovX&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">FoVy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cam_info&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">FovY&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">depth_params&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cam_info&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">depth_params&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">image&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">image&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">invdepthmap&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">invdepthmap&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">image_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cam_info&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">image_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">uid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">data_device&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data_device&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">train_test_exp&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">train_test_exp&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">is_test_dataset&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">is_test_dataset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">is_test_view&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cam_info&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">is_test&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘çš„ç›´æ¥æƒ³æ³•æ˜¯è¿›è¡Œæƒè¡¡ï¼šå›¾åƒåŠ è½½æ—¶é—´å¯èƒ½ä¸å€¼å¾—æ¶ˆè€—è¿™ä¹ˆå¤šå†…å­˜ï¼Œå°¤å…¶æ˜¯è€ƒè™‘åˆ°åç»­çš„å·¨å¤§è®­ç»ƒè´Ÿæ‹…ã€‚
å› æ­¤ï¼Œæˆ‘ç¼–å†™äº†ä¸€ä¸ª &lt;code>LazyLoader&lt;/code> ç±»ï¼Œå°† &lt;code>Camera&lt;/code> ç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°ç¬¬ä¸€æ¬¡å¼•ç”¨ã€‚å®ç°ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">scene.cameras&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Camera&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">LazyLoader&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="bp">cls&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">kwargs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cls&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">cls&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">args&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">args&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kwargs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">kwargs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__getattribute__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;cls&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;args&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;kwargs&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;instance&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">super&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__getattribute__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cls&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kwargs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">getattr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__del__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">del&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">instance&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å› æ­¤ï¼Œ&lt;code>Camera&lt;/code> ç±»æ„å»ºçš„åŸå§‹å¼•ç”¨ä¿®æ”¹ä¸º&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- return Camera(colmap_id=cam_info.uid, R=cam_info.R, T=cam_info.T,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+ return LazyLoader(Camera, colmap_id=cam_info.uid, R=cam_info.R, T=cam_info.T,
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ &lt;code>train.py&lt;/code> ä¸­çš„ä¸»è®­ç»ƒå¾ªç¯ä¸­ä½¿ç”¨åï¼Œå›¾åƒä¼šè¢«ç«‹å³åˆ é™¤ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡ä½¿ç”¨å†è¢«åˆ›å»ºã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="line">&lt;span class="cl"> # Loss
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gt_image = viewpoint_cam.original_image.cuda()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ del viewpoint_cam
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> Ll1 = l1_loss(image, gt_image)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> loss = (1.0 - opt.lambda_dssim) * Ll1 + opt.lambda_dssim * (1.0 - ssim(image, gt_image))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> loss.backward()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶è€Œï¼Œå¥‡æ€ªçš„æ˜¯ï¼Œå†…å­˜ä½¿ç”¨é‡åœ¨å¼€å§‹æ—¶ç¡®å®æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå›¾åƒä¼šæŒ‰ç…§é¢„æœŸé€ä¸ªåŠ è½½ã€‚ä½†æœ€åå´å¢åŠ åˆ°äº† 20GB ä»¥ä¸Šï¼Œä¹‹åä»æœªå‡å°‘è¿‡ã€‚æ‰€ä»¥æˆ‘æ„è¯†åˆ°çœŸæ­£çš„é—®é¢˜æ˜¯å†…å­˜æ³„æ¼ã€‚&lt;/p>
&lt;h2 id="ç¬¬äºŒä¸ªè¡¥ä¸---å†…å­˜æ³„æ¼ä¿®å¤">&lt;a href="#%e7%ac%ac%e4%ba%8c%e4%b8%aa%e8%a1%a5%e4%b8%81---%e5%86%85%e5%ad%98%e6%b3%84%e6%bc%8f%e4%bf%ae%e5%a4%8d" class="header-anchor">&lt;/a>ç¬¬äºŒä¸ªè¡¥ä¸ - å†…å­˜æ³„æ¼ä¿®å¤
&lt;/h2>&lt;p>è¿™é‡Œçš„å†…å­˜æ³„æ¼éå¸¸ä»¤äººå›°æƒ‘ã€‚æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œæˆ‘åœ¨ Python ä¸­ä½¿ç”¨ &lt;code>del&lt;/code> æ¥åˆ é™¤å¯¹ &lt;code>Camera&lt;/code> ç±»çš„å¼•ç”¨ï¼Œæ‰€æœ‰çš„å†…å­˜åº”è¯¥åŒæ—¶è¢«æ¸…é™¤ã€‚æˆ‘è¯•å›¾åˆ°å¤„å¯»æ‰¾åŸå› ï¼Œä½†åªå‘ç°å®ƒä¸ PyTorch æœ‰å…³ã€‚ç”±äºæ— æ³•æ·±å…¥ç ”ç©¶ CUDA å¼ é‡ï¼Œæˆ‘å¼€å§‹å°è¯•åœ¨ Python ä»£ç ä¸­çš„ &lt;code>del&lt;/code> æ‰€æœ‰ç›¸å…³å†…å®¹ã€‚å¹¸è¿çš„æ˜¯ï¼Œå®ƒæˆåŠŸäº†ã€‚&lt;/p>
&lt;p>è¡¥ä¸å¯åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯ç»§ç»­æé«˜å›¾åƒåŠ è½½çš„æ•ˆç‡ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="line">&lt;span class="cl">&lt;span class="gh">diff --git a/scene/__init__.py b/scene/__init__.py
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gh">&lt;/span>&lt;span class="gd">--- a/scene/__init__.py
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+++ b/scene/__init__.py
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span>&lt;span class="gu">@@ -37,9 +37,6 @@ class Scene:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> self.loaded_iter = load_iteration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> print(&amp;#34;Loading trained model at iteration {}&amp;#34;.format(self.loaded_iter))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- self.train_cameras = {}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- self.test_cameras = {}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">-
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span> if os.path.exists(os.path.join(args.source_path, &amp;#34;sparse&amp;#34;)):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> scene_info = sceneLoadTypeCallbacks[&amp;#34;Colmap&amp;#34;](args.source_path, args.images, args.eval)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif os.path.exists(os.path.join(args.source_path, &amp;#34;transforms_train.json&amp;#34;)):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">@@ -67,12 +64,8 @@ class Scene:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> random.shuffle(scene_info.test_cameras) # Multi-res consistent random shuffling
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.cameras_extent = scene_info.nerf_normalization[&amp;#34;radius&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">-
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- for resolution_scale in resolution_scales:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- print(&amp;#34;Loading Training Cameras&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- self.train_cameras[resolution_scale] = cameraList_from_camInfos(scene_info.train_cameras, resolution_scale, args)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- print(&amp;#34;Loading Test Cameras&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- self.test_cameras[resolution_scale] = cameraList_from_camInfos(scene_info.test_cameras, resolution_scale, args)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+ self.scene_info = scene_info
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ self.args = args
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if self.loaded_iter:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.gaussians.load_ply(os.path.join(self.model_path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">@@ -87,7 +80,7 @@ class Scene:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> self.gaussians.save_ply(os.path.join(point_cloud_path, &amp;#34;point_cloud.ply&amp;#34;))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def getTrainCameras(self, scale=1.0):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- return self.train_cameras[scale]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+ return cameraList_from_camInfos(self.scene_info.train_cameras, scale, self.args)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def getTestCameras(self, scale=1.0):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- return self.test_cameras[scale]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>\ No newline at end of file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ return cameraList_from_camInfos(self.scene_info.test_cameras, scale, self.args)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span>\ No newline at end of file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gh">diff --git a/scene/cameras.py b/scene/cameras.py
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gh">&lt;/span>&lt;span class="gd">--- a/scene/cameras.py
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+++ b/scene/cameras.py
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span>&lt;span class="gu">@@ -17,6 +17,7 @@ from utils.graphics_utils import getWorld2View2, getProjectionMatrix
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> class Camera(nn.Module):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def __init__(self, colmap_id, R, T, FoVx, FoVy, image, gt_alpha_mask,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image_name, uid,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ raw_image=None,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> trans=np.array([0.0, 0.0, 0.0]), scale=1.0, data_device = &amp;#34;cuda&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> super(Camera, self).__init__()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">@@ -29,6 +30,14 @@ class Camera(nn.Module):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> self.FoVy = FoVy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.image_name = image_name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ if raw_image is not None:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ image = raw_image[:3, ...]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ gt_alpha_mask = None
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ if raw_image.shape[1] == 4:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ gt_alpha_mask = raw_image[3:4, ...]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ del raw_image
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> try:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.data_device = torch.device(data_device)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> except Exception as e:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">@@ -39,9 +48,11 @@ class Camera(nn.Module):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> self.original_image = image.clamp(0.0, 1.0).to(self.data_device)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.image_width = self.original_image.shape[2]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.image_height = self.original_image.shape[1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ del image
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if gt_alpha_mask is not None:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.original_image *= gt_alpha_mask.to(self.data_device)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ del gt_alpha_mask
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> else:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.original_image *= torch.ones((1, self.image_height, self.image_width), device=self.data_device)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">@@ -56,6 +67,9 @@ class Camera(nn.Module):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> self.full_proj_transform = (self.world_view_transform.unsqueeze(0).bmm(self.projection_matrix.unsqueeze(0))).squeeze(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.camera_center = self.world_view_transform.inverse()[3, :3]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ def __del__(self):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ del self.original_image, self.world_view_transform, self.projection_matrix, self.full_proj_transform, self.camera_center
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> class MiniCam:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def __init__(self, width, height, fovy, fovx, znear, zfar, world_view_transform, full_proj_transform):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.image_width = width
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gh">diff --git a/train.py b/train.py
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gh">&lt;/span>&lt;span class="gd">--- a/train.py
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+++ b/train.py
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span>&lt;span class="gu">@@ -44,103 +43,82 @@ def training(dataset, opt, pipe, testing_iterations, saving_iterations, checkpoi
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gu">&lt;/span> iter_start = torch.cuda.Event(enable_timing = True)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> iter_end = torch.cuda.Event(enable_timing = True)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- viewpoint_stack = None
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+ viewpoint_stack = scene.getTrainCameras()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> ema_loss_for_log = 0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> progress_bar = tqdm(range(first_iter, opt.iterations), desc=&amp;#34;Training progress&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> first_iter += 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¬¬äºŒéƒ¨åˆ†æ˜¯åœ¨ä¸»è®­ç»ƒå¾ªç¯ä¸­ä½¿ç”¨ &lt;code>del&lt;/code>ã€‚å› ä¸ºæˆ‘å¯¹è®­ç»ƒè¿‡ç¨‹åšäº†å…¶ä»–ä¿®æ”¹ï¼Œå› æ­¤æ— æ³•åœ¨æ­¤ç»™å‡ºå®Œæ•´çš„è¡¥ä¸ã€‚ç¼©å‡ç‰ˆå¦‚ä¸‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">iteration&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">first_iter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">iterations&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iter_start&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gaussians&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">update_learning_rate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iteration&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Every 1000 its we increase the levels of SH up to a maximum degree&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">iteration&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">1000&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gaussians&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">oneupSHdegree&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Pick a random Camera&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">viewpoint_stack&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">del&lt;/span> &lt;span class="n">viewpoint_stack&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">viewpoint_stack&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">scene&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getTrainCameras&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">viewpoint_cam&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">viewpoint_stack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">viewpoint_stack&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Render&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">iteration&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">debug_from&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pipe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">debug&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rand&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;cuda&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">random_background&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="n">background&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">render_pkg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">viewpoint_cam&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">gaussians&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">pipe&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">bg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">image&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">viewspace_point_tensor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">visibility_filter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">radii&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">render_pkg&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;render&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">render_pkg&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;viewspace_points&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">render_pkg&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;visibility_filter&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">render_pkg&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;radii&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Loss&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gt_image&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">viewpoint_cam&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">original_image&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cuda&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Ll1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">l1_loss&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">image&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">gt_image&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lambda_dssim&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">Ll1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lambda_dssim&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ssim&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">image&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">gt_image&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">backward&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iter_end&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">no_grad&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Progress bar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ema_loss_for_log&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.4&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mf">0.6&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">ema_loss_for_log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">iteration&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">progress_bar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_postfix&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="s2">&amp;#34;Loss&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">ema_loss_for_log&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">progress_bar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">iteration&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">iterations&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">progress_bar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Log and save&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cuda&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">empty_cache&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">iteration&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">saving_iterations&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">[ITER &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">] Saving Gaussians&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iteration&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">scene&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iteration&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Densification&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">iteration&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">densify_until_iter&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Keep track of max radii in image-space for pruning&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gaussians&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max_radii2D&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">visibility_filter&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gaussians&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max_radii2D&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">visibility_filter&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">radii&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">visibility_filter&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gaussians&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_densification_stats&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">viewspace_point_tensor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">visibility_filter&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">iteration&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">densify_from_iter&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">iteration&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">densification_interval&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size_threshold&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">20&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">iteration&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">opacity_reset_interval&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="kc">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gaussians&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">densify_and_prune&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">densify_grad_threshold&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.005&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">scene&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cameras_extent&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size_threshold&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">iteration&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">opacity_reset_interval&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">dataset&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">white_background&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">iteration&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">densify_from_iter&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gaussians&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reset_opacity&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Optimizer step&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">iteration&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">opt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">iterations&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gaussians&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">step&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gaussians&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">optimizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zero_grad&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">set_to_none&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">iteration&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">checkpoint_iterations&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">[ITER &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">] Saving Checkpoint&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iteration&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">torch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">gaussians&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">capture&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">iteration&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">scene&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">model_path&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;/chkpnt&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iteration&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;.pth&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">del&lt;/span> &lt;span class="n">viewpoint_cam&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">image&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">viewspace_point_tensor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">visibility_filter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">radii&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">gt_image&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ll1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">loss&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">render_pkg&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨æ‰“äº†ä¸¤ä¸ªè¡¥ä¸ä¹‹åï¼Œå†…å­˜ä½¿ç”¨é‡ç»ˆäºå¾—åˆ°äº†æ§åˆ¶ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼ŒGPU å†…å­˜ä½¿ç”¨é‡å¯ä»¥æ§åˆ¶åœ¨ 10GB ä»¥ä¸‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://sudofree.xyz/p/solve-memory-leak-in-vanilla-gaussian-splatting-code/memory-leak.png"
width="482"
height="328"
srcset="https://sudofree.xyz/p/solve-memory-leak-in-vanilla-gaussian-splatting-code/memory-leak_hu17105495424874006886.png 480w, https://sudofree.xyz/p/solve-memory-leak-in-vanilla-gaussian-splatting-code/memory-leak_hu15803852992229199328.png 1024w"
loading="lazy"
alt="Memory Leak"
class="gallery-image"
data-flex-grow="146"
data-flex-basis="352px"
>&lt;/p>
&lt;h2 id="ç»“è®º">&lt;a href="#%e7%bb%93%e8%ae%ba" class="header-anchor">&lt;/a>ç»“è®º
&lt;/h2>&lt;p>æˆ‘ä¸ç¡®å®šæ˜¯å¦åº”è¯¥å‘åŸå§‹ç‰ˆæœ¬åº“æŠ¥å‘Šè¿™ä¸ªé—®é¢˜ã€‚å› ä¸ºåœ¨è¿‡å»çš„ä¸€å¹´é‡Œï¼Œäººä»¬å¹¶æ²¡æœ‰æ„è¯†åˆ°å†…å­˜æ³„æ¼é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä¸ç¡®å®šè¿™æ˜¯å¦æ˜¯ä¸€ä¸ªæ™®éé—®é¢˜ï¼Œæˆ–è€…åªæ˜¯æˆ‘çš„æƒ…å†µã€‚æ€»ä¹‹ï¼Œæˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©æ­£åœ¨ä¸ºåŒæ ·é—®é¢˜è€Œè‹¦æ¼çš„äººã€‚&lt;/p></description></item></channel></rss>