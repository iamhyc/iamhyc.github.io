[{"content":"å‰è¨€ï¼š HarmonyOS NEXTçš„ç”Ÿæ€å»ºè®¾çœŸæ˜¯ä¸€ä¸ªå·¨å‘ï¼Œç‰¹åˆ«æ˜¯å¯¹äº ç‹¬ç«‹å¼€å‘è€…ä¸å¼€æºé¡¹ç›® æ¥è¯´ï¼Œæ›´ä¸ç”¨è¯´å…ƒæœåŠ¡é¢å¯¹æ™®é€šåº”ç”¨å¤©ç„¶åŠ£åŠ¿ï¼Œç®€ç›´æ˜¯æ¥è‡ªå®¡æ ¸å’Œç«å“çš„åŒé‡å‹åŠ›ã€‚ä½†æ˜¯æ€€ç€ä¸èƒ½è®©æ–°å…´å¹³å°è¢«ç²—åˆ¶æ»¥é€ çš„åº”ç”¨æ‰€æ·¹æ²¡çš„ä¿¡å¿µï¼Œæˆ‘è¿˜æ˜¯åšæŒæŠŠè¿™ä¸ªé¡¹ç›®çš„ä¸»è¦åŠŸèƒ½å®Œæˆäº†ï¼Œç‰ˆæœ¬å·ä» v0.1.0 æ•°åˆ°äº† v1.0.0ã€‚ ğŸ‰ğŸ‰ğŸ‰ å®Œç»“æ’’èŠ± ğŸ‰ğŸ‰ğŸ‰\nP.S. æˆªè‡³æœ¬æ–‡ç« å‘å¸ƒæ—¶ï¼ŒAigis Authenticator v1.0.0 ä»åœ¨å®¡æ ¸ä¸­ï¼Œè™½ç„¶æ—©äº12æœˆ27æ—¥ä¸Šåˆæäº¤å®¡æ ¸ï¼Œä½†å¤§æ¦‚è¦è¢«æ‹–åˆ°2025å¹´äº† ğŸ˜…\né¡¹ç›®ç®€ä»‹ Aigis æ˜¯ä¸€ä¸ªæœåŠ¡äº HarmonyOS NEXT çš„ 2FA è®¤è¯å…ƒæœåŠ¡ï¼Œé‡‡ç”¨çº¯ ArkTS å®ç°ï¼Œæ— ä»»ä½•ä¸‰æ–¹ä¾èµ–ã€‚\nAigis çš„ç›®æ ‡æ˜¯æˆä¸ºå®‰å“å¹³å° Aegis Authenticator çš„è½»é‡çº§æ›¿ä»£å“ã€‚å½“å‰ï¼Œå‡­å€Ÿä¸åˆ° 300KB çš„å®‰è£…åŒ…å¤§å°ï¼ŒAigis å·²å®ç°äº†å…¶è¶…è¿‡ 90% çš„åŠŸèƒ½ï¼Œä¸”å®ç°äº†å­˜å‚¨æ•°æ®æ ¼å¼çš„å®Œæ•´å…¼å®¹ï¼Œå¯ä»¥æ”¯æŒåŠ å¯†å¤‡ä»½æ–‡ä»¶çš„ç›¸äº’å¯¼å…¥å¯¼å‡ºã€‚åŒæ—¶ï¼ŒAigis ä¹Ÿåœ¨è®¾è®¡ä¸Šåšäº†ä¸€äº›æ”¹è¿›ï¼Œæä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œæ•°æ®å®‰å…¨æ€§ã€‚\nå¼€å‘åŠ¨æœº æˆ‘åœ¨ 2024å¹´9æœˆ å‡çº§åˆ° HarmonyOS NEXT beta ç‰ˆæœ¬åï¼Œè¢«è¿«æ”¾å¼ƒäº†å¤§é‡å®‰å“è½¯ä»¶ï¼Œä»¥åŠå¿å—å„ç§æœ‰ç¼ºé™·çš„åº”ç”¨åŠŸèƒ½ï¼Œä½†è¿˜æ˜¯å‘ç°ä¸€ä¸ªé—®é¢˜ä¸èƒ½è§£å†³ï¼šæ²¡æœ‰ Aegis Authenticator çš„æ›¿ä»£å“ã€‚\nå½“æ—¶çš„åº”ç”¨å¸‚åœºä¸­ï¼Œåªæœ‰ä¸€ä¸ªå« â€œæ‰‹æœºä»¤ç‰Œâ€ çš„ä¸‘åˆ°çˆ†çš„è½¯ä»¶ï¼ˆç›®å‰ç«Ÿç„¶è¿˜åœ¨æ›´æ–°ï¼è¿˜æ˜¯é‚£ä¹ˆä¸‘ï¼ï¼‰ï¼Œè¿˜ä¸å­˜åœ¨åŒç±»ç«å“è™½ç„¶ä¹‹åå“æ˜“é€šçš„ä¸Šæ¶è¯æ˜å¤§å®¶éƒ½æ˜¯å°ä¸‘ğŸ¤¡ã€‚åŒæ—¶ï¼Œæˆ‘æœ¬æ¥è®¡åˆ’å¼€å‘ä¸€ä¸ª RetroArch çš„é¸¿è’™å‰ç«¯ï¼ŒRetrohosï¼Œæ­£å¥½ç§¯ç´¯ä¸€ä¸‹ GUI çš„å¼€å‘ç»éªŒã€‚äºæ˜¯æˆ‘åœ¨å›½åº†å‡æœŸæœŸé—´ï¼Œå¿«é€Ÿå­¦ä¹ äº†ä¸‹ HarmonyOS NEXT çš„å¼€å‘æ–‡æ¡£ï¼Œå¹¶åœ¨ å‡æœŸç»“æŸå‰ å®Œæˆäº†è¿™ä¸ªé¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½ï¼šOTP è®¡ç®—ä¸å±•ç¤ºåŠŸèƒ½ã€‚åœ¨äº 10æœˆ9æ—¥ æäº¤å¤‡æ¡ˆå®¡æ ¸ï¼Œ10æœˆ15æ—¥ è¿‡å®¡åï¼Œæˆ‘äºå½“æ—¥ä¸Šæ¶äº† Aigis çš„é¦–ä¸ªæµ‹è¯•ç‰ˆæœ¬ã€‚\nè®¾è®¡ç†å¿µ Aigis çš„ä¸»ä½“è®¾è®¡è¯­è¨€å‚è€ƒäº†åŸç‰ˆ Aegis Authenticatorï¼ŒåŒæ—¶å› ä¸ºå…ƒæœåŠ¡çš„å½¢æ€åšå‡ºäº†ä¸€å®šè°ƒæ•´ï¼›ä¸»é¢˜é…è‰²å¤§è‡´å‚è€ƒäº†Aigisã€‚\nä¸»é¡µåˆ—è¡¨æ¡ç›®å‚è€ƒäº†å½“å‰ç³»ç»Ÿåº”ç”¨ é‚®ä»¶ çš„è®¾è®¡ï¼Œç¼–è¾‘é¡µé¢é‡‡ç”¨äº† Aegis Authenticator çš„å¸ƒå±€æ–¹æ¡ˆã€‚è®¾ç½®é¡µé¡¹æ¡ç›®å‚è€ƒäº†ç³»ç»Ÿ è®¾ç½® çš„è®¾è®¡ï¼Œä¼˜å…ˆä½¿ç”¨äº†ç³»ç»Ÿæä¾›çš„ç»„ä»¶èŒƒå¼ï¼Œä»¥ä¿è¯ç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§ã€‚\nAigis Authenticator åœ¨è®¾è®¡ä¸­å§‹ç»ˆæŠŠ å®‰å…¨ æ”¾åœ¨ç¬¬ä¸€ä½ã€‚\nè™½ç„¶ç›¸è¾ƒäºæ™®é€šé¸¿è’™åº”ç”¨ï¼Œå…ƒæœåŠ¡æ— æ³•ä½¿ç”¨ Asset Kit æ•°æ®å­˜å‚¨ï¼Œç³»ç»Ÿå¤‡ä»½ï¼Œäº‘åŒæ­¥ç­‰APIï¼Œä½†è¿™ä¹Ÿä»åŸç†ä¸Šä¿è¯äº†å…ƒæœåŠ¡çš„å®‰å…¨æ€§ï¼šåœ¨æ²¡æœ‰ç½‘ç»œæƒé™çš„å‰æä¸‹ï¼Œé™¤éå¾—åˆ°ç”¨æˆ·çš„è®¸å¯ï¼Œç”¨æˆ·çš„æ•°æ®æ— æ³•ä»åº”ç”¨æ²™ç®±ä¸­é€ƒé€¸ã€‚\nç›¸å¯¹çš„ï¼Œåœ¨æ•°æ®å­˜å‚¨æ–¹é¢ï¼ŒAigis å‚è€ƒ Aegis Authenticator çš„è®¾è®¡ï¼Œå°†æ¡ç›®å¯†é’¥å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼ˆç”¨æˆ·é¦–é€‰é¡¹ï¼‰ã€‚åŒæ—¶ï¼Œç”¨æˆ·éœ€è¦è®¾ç½®ä¸»å¯†é’¥ï¼Œå¹¶ç»è¿‡ç»å…¸ PBKDF2 æ´¾ç”Ÿç®—æ³•ï¼Œç”Ÿæˆ AES-256 å¯†é’¥å¹¶ä¿å­˜åœ¨å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼ˆTEEï¼‰ä¸­ï¼Œç”¨äºæ¡ç›®å¯†é’¥çš„åŠ è§£å¯†ä½¿ç”¨ã€‚\nåœ¨è¿™ä¸€æ•°æ®å®‰å…¨å­˜å‚¨çš„æœºåˆ¶ä¸‹ï¼ŒAigis é€šè¿‡ä»¥ä¸‹çš„ä¸€ç³»åˆ—å®‰å…¨è®¾è®¡ï¼Œä¿è¯ç”¨æˆ·å¯¹æ•°æ®çš„ç»å¯¹æŒæ§ï¼š\næ¡ç›®/å¯†é’¥åˆ†ç¦»å­˜å‚¨ï¼šåœ¨ç”¨æˆ·é¦–é€‰é¡¹æ–‡ä»¶ä¸­ï¼Œæ¡ç›®å’Œå¯†é’¥åˆ†åˆ«å­˜å‚¨ï¼Œåªå¯¹å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œå®ç°äº† é¡µé¢æ¸²æŸ“æ•ˆç‡ï¼ˆä»…éœ€æ¡ç›®ï¼‰å’Œ ä»¤ç‰Œè®¡ç®—ï¼ˆéœ€è¦æ¡ç›®+å¯†é’¥ï¼‰çš„å®‰å…¨æ€§ çš„å¹³è¡¡ã€‚åœ¨å¯¼å‡ºå¤‡ä»½æ–‡ä»¶æ—¶ï¼Œæ¡ç›®å’Œå¯†é’¥åˆ†åˆ«ä½¿ç”¨ç‹¬ç«‹çš„å¯†é’¥ææ–™åŠ å¯†ï¼Œè¿›ä¸€æ­¥æå‡äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚\nåŠ å¯†/è§£å¯†å¯†é’¥åˆ†ç¦»è®¾è®¡ï¼šå¾—ç›Šäº HUKS çš„è®¾è®¡ï¼ŒAigis å°†æ´¾ç”Ÿçš„ä¸»å¯†é’¥å­˜å‚¨åœ¨å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼ˆTEEï¼‰ä¸­ï¼Œå¹¶æ ¹æ®ç”¨é€”åˆ†ä¸ºä¸¤ä¸ªå¯†é’¥ï¼šä¸€ä¸ªç”¨äºåŠ å¯†å¯†é’¥ï¼ˆenc_master_keyï¼‰ï¼Œä¸éœ€è¦é‰´æƒå³å¯è°ƒç”¨ï¼›å¦ä¸€ä¸ªç”¨äºè§£å¯†å¯†é’¥ï¼ˆdec_master_keyï¼‰ï¼Œä¸¥æ ¼é™åˆ¶åœ¨åº”ç”¨ä¸­è°ƒç”¨ï¼Œåœ¨ v2.0.0 ä¹‹åæ”¯æŒåœ¨ ATL3 çº§åˆ«å®‰å…¨éªŒè¯ä¹‹åæ‰å¯ä»¥è°ƒç”¨ã€‚\nåŠ å¯†JSONæ–‡ä»¶å¤‡ä»½ï¼šç”¨æˆ·åœ¨è®¾ç½®ä¸»å¯†é’¥åï¼Œå¯ä»¥å¯¼å‡ºåŠ å¯†çš„ JSON æ ¼å¼æ•°æ®æ–‡ä»¶ï¼Œç”¨äºå¤‡ä»½æˆ–è€…è¿ç§»åˆ°å¦ä¸€ Aigis å®ä¾‹ä¸­ã€‚åŒæ—¶ï¼Œç”¨æˆ·å¯åœ¨ PC æˆ–å…¶ä»–è®¾å¤‡ä¸Šï¼Œé€šè¿‡è¾“å…¥ä¸»å¯†é’¥å¹¶è°ƒç”¨ PBKDF2 ç®—æ³•ï¼Œè‡ªç”±è§£å¯†æ•°æ®æ–‡ä»¶ã€‚\nç”Ÿç‰©è¯†åˆ«è§£é”ï¼šAigis æ”¯æŒ ATL1 çº§åˆ«çš„ç”Ÿç‰©è¯†åˆ«è§£é”åº”ç”¨ç•Œé¢ï¼ŒåŒæ—¶å…è®¸è®¾ç½® é¢éƒ¨/æŒ‡çº¹/PINç  ç”¨äºè§£é”çš„ä¼˜å…ˆçº§ã€‚ä¸ Aegis Authenticator ä¸åŒçš„æ˜¯ï¼ŒAigis åœ¨æœªè®¾ç½®ä¸»å¯†é’¥æ—¶ä¹Ÿæ”¯æŒå¯ç”¨ç”Ÿç‰©è§£é”ï¼Œè¯¥æƒ…å†µä¸‹æ‚¨çš„å¯†é’¥ä»ä»¥æ˜æ–‡å­˜å‚¨åœ¨åº”ç”¨æ²™ç®±ä¸­ã€‚ä» v2.0.0 å¼€å§‹ï¼ŒAigis å°†æ”¯æŒ ATL3 çº§åˆ«çš„ç”Ÿç‰©è§£é”ï¼Œè¯¥å®‰å…¨æ€§å°†ä¸ Aegis Authenticator ç”Ÿç‰©è§£é”å®‰å…¨æ€§ç­‰ä»·ã€‚\néšç§çª—å£ä¿æŠ¤ï¼šAigis é»˜è®¤ä¸å…è®¸æˆªå±ã€å±å¹•å½•åˆ¶ã€ä»»æ„æ‹–æ‹½å†…å®¹ï¼Œä»¥é¿å…å¯èƒ½çš„ä¸ªäººä¿¡æ¯æ³„éœ²ï¼›å¦ä¸€æ–¹é¢ï¼Œä» v0.8.0 ç‰ˆæœ¬å¼€å§‹ï¼Œç”¨æˆ·åœ¨è®¾ç½®ä¸»å¯†é’¥åï¼Œå¯ä»¥è®¾ç½®ç¦ç”¨éšç§çª—å£ä¿æŠ¤ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æˆªå±ã€‚ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è®¾ç½®ä¸»å¯†é’¥åï¼Œæ¡ç›®çš„äºŒç»´ç åˆ†äº«åŠŸèƒ½å°†ä¼šè¢«è‡ªåŠ¨ç¦ç”¨ï¼‰\nç‰¹æ€§ä¸€è§ˆ ä¸»é¡µé¢åˆ—è¡¨ï¼Œæ”¯æŒæ¡ç›®æ‹–æ‹½æ’åºï¼Œæœç´¢ï¼Œç½®é¡¶\nç¼–è¾‘é¡µé¢æ”¯æŒ äºŒç»´ç åˆ†äº« æ¡ç›®\nä»…å½“ä¸»å¯†é’¥æœªè®¾ç½®æ—¶ï¼Œè®¾ç½®ä¸»å¯†é’¥åï¼Œåˆ†äº«åŠŸèƒ½å°†è¢«è‡ªåŠ¨ç¦ç”¨ é€šç”¨/å¤–è§‚è®¾ç½®ï¼Œå¯¹é½ Aegis Authenticator ç•Œé¢å®šåˆ¶éœ€æ±‚\næ”¯æŒ Aegis æ ¼å¼å›¾æ ‡åŒ…å¯¼å…¥\nä¸»å¯†é’¥è®¾ç½®ï¼Œå¯†ç å‘¨æœŸæé†’ï¼Œå±å¹•å®‰å…¨ï¼Œç”Ÿç‰©è¯†åˆ«è§£é”\næ‰«ç æ”¯æŒ Google Authenticator äºŒç»´ç å¯¼å…¥å¯¼å‡º\nçº¯ ArkTS å®ç° otpauth-migration payload Protobuf ç¼–è§£ç  æ”¯æŒ Aegis Authenticator åŠ å¯†å¤‡ä»½æ–‡ä»¶å¯¼å…¥å¯¼å‡º\nå¼€å‘é¿å‘æŒ‡å— ä»¥ä¸‹å†…å®¹ä»…æ¶‰åŠæœ¬äººåœ¨å¼€å‘ Aigis è¿‡ç¨‹ä¸­æ‘¸ç´¢é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶ä¸å…¨é¢ï¼Œä»…ä¾›å‚è€ƒã€‚\nå¼€å‘æ–‡æ¡£çš„è·å– è™½ç„¶è®ºå›é‡Œå¾ˆå¤šåæ§½å¼€å‘æ–‡æ¡£ä¸å¥½æŸ¥çœ‹ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªAPIçš„ç”¨æ³•è¦è·³è½¬å¥½å‡ ä¸ªé¡µé¢ï¼ˆäº‹å®ä¹Ÿç¡®å®å¦‚æ­¤ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªå¼€å‘æ–‡æ¡£æ˜¯å’Œ OpenHarmonyæ–‡æ¡£ ä¿æŒä¸€è‡´çš„ï¼Œæ‰€ä»¥åœ¨æŸ¥çœ‹æ–‡æ¡£æ—¶éœ€è¦åˆ†æ¸…ä¸»æ¬¡ã€‚\né¦–å…ˆï¼ŒæŒ‡å— å’Œ APIå‚è€ƒï¼Œè¿™ä¸¤ä¸ªå’Œ OpenHarmony ä¿æŒä¸€è‡´ï¼Œéšç‰ˆæœ¬å·å‘å¸ƒï¼ˆè™½ç„¶ OpenHarmony ç½‘ç«™åªæ”¾å‡ºäº† 5.0.0 çš„æ–‡æ¡£ï¼Œä½† 5.0.1 (API 13) çš„æ–‡æ¡£åœ¨ giteeä»“åº“ ç¡®å®æ˜¯å­˜åœ¨çš„ï¼‰ã€‚\nå…¶æ¬¡ï¼Œæœ€ä½³å®è·µ å’Œ FAQï¼Œè¿™ä¸¤ä¸ªæ˜¯ HarmonyOS NEXT ç‰¹æœ‰çš„æ–‡æ¡£ï¼Œæ›´æ–°é¢‘ç‡ä¼šé«˜ä¸€äº›ï¼ˆä¹Ÿæ²¡é«˜å¤šå°‘ï¼‰ï¼Œä¸»è¦æ˜¯å¯¹å¼€å‘æ–‡æ¡£çš„ç¼ºå¤±éƒ¨åˆ†åšå¿«é€Ÿçš„è¡¥å……ï¼Œä½†å…·ä½“åŠŸèƒ½çš„ç¼ºé™·è§£å†³å’Œç‰¹æ€§ï¼Œç›®å‰æ¥çœ‹è¿˜æ˜¯è¦ç­‰ä¸Šæ¸¸ OpenHarmony å‘ç‰ˆä¹‹åæ‰èƒ½åŒæ­¥ã€‚å¦å¤–ï¼Œå˜æ›´é¢„å‘Š ä¹Ÿæœ‰ä¸€å®šç”¨å¤„ï¼Œä½†æˆ‘æ˜¯çœ‹ä¸€æ¬¡å¤±æœ›ä¸€æ¬¡ï¼Œåæ­£æ˜¯æ²¡ä¿®å¤è¿‡æˆ‘æåˆ°çš„é—®é¢˜ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œåœ¨çº¿æ–‡æ¡£é¡µé¢çš„â€œæ™ºèƒ½å®¢æœâ€ä»¥åŠå…¨å±€æœç´¢åŠŸèƒ½ï¼Œä¹Ÿæœ‰ä¸€å®šç”¨å¤„ï¼Œä½†æ˜¯ä¸è¦æŠ±å¤ªå¤§å¸Œæœ›ï¼Œæ¯•ç«Ÿç°åœ¨ç”Ÿæ€è¿˜åœ¨å»ºè®¾ä¸­ï¼Œå¾ˆå¤šé—®é¢˜éƒ½æ˜¯éœ€è¦è‡ªå·±æ‘¸ç´¢ã€‚\nå¤‡æ¡ˆä¸è½¯ä»¶è‘—ä½œæƒ å…³äºå¤‡æ¡ˆï¼šæ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œå•æœº + å…ƒæœåŠ¡ï¼Œå°±ä¸éœ€è¦å¤‡æ¡ˆäº†ï¼›ä½†æ˜¯éœ€è¦å†…ç½®åº”ç”¨å¯åŠ¨æ—¶å¼¹å‡ºçš„â€œç”¨æˆ·åè®®â€å’Œâ€œéšç§åè®®â€ï¼Œå…·ä½“å†…å®¹è¯·å‚è€ƒç°æœ‰åº”ç”¨çš„åè®®ï¼Œä¹Ÿå¯ä»¥æœç´¢è®ºå›é‡Œçš„å¸–å­ï¼Œæœ‰äººåˆ†äº«è¿‡ã€‚å¦‚æœæ˜¯å…¶ä»–æƒ…å†µï¼Œåˆ™ä¸€å®šéœ€è¦å¤‡æ¡ˆï¼Œå»ºè®®åœ¨åº”ç”¨å¯åŠ¨å¼€å‘æ—¶ï¼Œå°±å¼€å§‹å¯åŠ¨è¿™ä¸ªæµç¨‹ï¼›è¿™æ ·åœ¨åº”ç”¨åŸºæœ¬åŠŸèƒ½å®Œæˆæ—¶ï¼Œå¤‡æ¡ˆä¹Ÿå·®ä¸å¤šå®Œæˆå®¡æ ¸äº†ã€‚\nå…³äºè½¯ä»¶è‘—ä½œæƒï¼šå…ƒæœåŠ¡ä¸éœ€è¦è½¯ä»¶è‘—ä½œæƒï¼Œåº”ç”¨éœ€è¦è½¯ä»¶è‘—ä½œæƒï¼Œä½†ä¹Ÿå¯ä»¥ç”¨ç”µå­ç‰ˆæƒè¯ä¹¦ä»£æ›¿ï¼›ä¸æƒ³è®©ä»£ç†å…¬å¸èµšé’±ï¼Œå¯ä»¥è‡ªå·±ç”³è¯·ï¼Œä½†æ˜¯æ—¶é—´è¦é•¿ä¸€äº›ã€‚\nå·¥å•ç³»ç»Ÿçš„é‡è¦æ€§ åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ç–‘ä¼¼ APIç¼ºé™·/æ–‡æ¡£ç¼ºé™· çš„é—®é¢˜ï¼Œé¦–å…ˆè¯·åœ¨åœ¨å¼€å‘è€…è”ç›Ÿè®ºå›é‡Œæœç´¢ä¸€ä¸‹, çœ‹çœ‹æœ‰æ²¡æœ‰äººé‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ã€‚\nå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå»ºè®®ä¹Ÿä¸è¦å†å‘å¸–äº†ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å¼€å‘è€…è”ç›Ÿçš„å·¥å•ç³»ç»Ÿé‡Œæäº¤å·¥å•ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«çš„å¾—åˆ°å®˜æ–¹çš„å›å¤ã€‚\nè™½ç„¶å·¥å•ç³»ç»Ÿçš„å›å¤ä¹Ÿæ˜¯åƒç¯‡ä¸€å¾‹çš„å®¢æœå¤åˆ¶ç²˜è´´æ–‡æ¡£ï¼Œä½†å¦‚æœé—®é¢˜ç¡®å®å­˜åœ¨çš„è¯ï¼Œè¿˜æ˜¯ä¼šä¸Šå‡åˆ°å¼€å‘å›¢é˜Ÿçš„è§†é‡é‡Œï¼Œæœ‰å¯èƒ½ä¼šå¾—åˆ°è§£å†³ã€‚\nè€Œå¦‚æœæ˜¯å…³äºåº”ç”¨ä¸Šæ¶é‡åˆ°é—®é¢˜ï¼Œåˆ™éœ€è¦åœ¨ AppGalley Connect çš„â€œäº’åŠ¨ä¸­å¿ƒâ€æäº¤å·¥å•ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«çš„å¾—åˆ°å®¡æ ¸äººå‘˜çš„å›å¤ã€‚\nHUKS å¯†é’¥ç®¡ç†ä¸ä½¿ç”¨ HUKS çš„æ–‡æ¡£æ˜¯å­˜åœ¨å„ç§ç¼ºé™·çš„ï¼Œå®ƒåŸºäºè®¾å¤‡æä¾›çš„ TEE æ¥å®ç°ï¼Œèƒ½åŠ›è¾¹ç•Œæ˜¯å’Œè®¾å¤‡é«˜åº¦è€¦åˆçš„ï¼Œä½†æ–‡æ¡£ä¸Šå´æ²¡ä½“ç°è¿™ä¸€ç‚¹ã€‚ç›´æ¥å½±å“å°±æ˜¯ï¼Œæœ‰äº›APIåœ¨æ‰‹æœºç«¯æ ¹æœ¬æ²¡æ³•ç”¨ï¼Œä½†ä»–ä»¬çš„æµ‹è¯•å´æ²¡æœ‰é—®é¢˜ã€‚\nè¿™é‡Œåˆ—ä¸¾ä¸‹æˆ‘ä¸ªäººé‡åˆ°çš„é—®é¢˜ï¼Œè®ºå›ä¸Šçš„ç›¸å…³è®¨è®ºæ˜¯æ¯”è¾ƒå°‘çš„ï¼š\næµ‹è¯•å¯ç”¨çš„ï¼šå¯†é’¥å¯¼å…¥ï¼Œå¯†é’¥åˆ é™¤ï¼Œå¯†é’¥è¦†ç›–åˆ›å»ºï¼ŒAES ç›¸å…³åŠ è§£å¯†æ“ä½œï¼Œauthé‰´æƒè®¿é—®ï¼Œæˆ‘è¿™è¾¹è¯•è¿‡éƒ½æ˜¯æ²¡é—®é¢˜çš„ã€‚å¦‚æœ‰éœ€è¦çš„è¯ï¼Œå¯ä»¥å‚è€ƒæˆ‘å°è£…è‡ªç”¨çš„å·¥å…·ç±» HUKSUtilsã€‚\nHMAC æ–¹æ³•æœ€å¥½ä¸è¦ç”¨ï¼Œå…·ä½“æ¥è¯´ï¼Œä¹Ÿå°±æ˜¯ä¸è¦æœŸå¾…å¯ä»¥åœ¨ TEE é‡Œå®ŒæˆåŸºäº SHA1/SHA256 çš„ï¼Œéæ ‡å‡†å¯†é’¥é•¿åº¦ï¼ˆ256bit ä¹‹å¤–ï¼‰çš„ HMAC æ“ä½œï¼›å¦‚æœä½ ä¸ä¿¡çš„è¯ï¼Œå¯ä»¥å†™ä¸ªæµ‹è¯•ç”¨ä¾‹è¯•è¯•ï¼Œå¦‚æœèƒ½ç”¨çš„è¯ä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ä¸€å£° ï¼šï¼‰\nå¯†é’¥æ´¾ç”Ÿæ–¹æ³•ï¼šå¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ï¼ é¦–å…ˆï¼Œå®ƒåªæœ‰ PBKDF2 æ´¾ç”Ÿç®—æ³•ï¼Œè¿˜ä¸æ˜¯æ ‡å‡†å®ç°ï¼å®ƒçš„æ´¾ç”Ÿå¯†é’¥æ˜¯ä¸èƒ½åœ¨å…¶ä»–è®¾å¤‡ä¸Šé‡å¤ç”Ÿæˆçš„ï¼Œè€Œæ˜¯å’ŒTEEé‡Œçš„AESå¯†é’¥åŠä¸å¯æ§çš„åŠ å¯†å‚æ•°ç›¸å…³ï¼é¸¿è’™ä½¿ç”¨äº†ç§æœ‰çš„æ´¾ç”Ÿç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•çš„å®‰å…¨æ€§å’Œå¯é æ€§éƒ½æ˜¯æœªçŸ¥çš„ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼\nè€ƒè™‘åˆ°å½“å‰ ArkTS è™šæ‹Ÿæœºå¯¹äºåŠ å¯†ç®—æ³•çš„æ•ˆç‡é—®é¢˜ï¼Œæ¨èä½¿ç”¨ openssl ç»‘å®šçš„åŠ å¯†åº“ï¼Œå¦‚ @ohos-rs/opensslï¼Œæˆ–è€…æˆ‘æ‰‹æ“äº†ä¸€ä¸ª Scrypt å¯†é’¥æ´¾ç”Ÿç®—æ³•ï¼ˆä»…8KBå¤§å°ï¼‰ã€‚\nArkTS è™šæ‹Ÿæœºæ•ˆç‡é—®é¢˜ æ­£å¦‚ä¸Šé¢æåˆ°çš„ï¼ŒArkTS è™šæ‹Ÿæœºå¯¹äºåŠ å¯†ç®—æ³•çš„æ•ˆç‡é—®é¢˜ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚æ—©åœ¨API 10çš„ç‰ˆæœ¬ï¼Œå°±æœ‰äººåé¦ˆè¿‡ @ohos/crypto-js åŠ è§£å¯†å¡æ­» çš„é—®é¢˜ï¼Œä½†ç›´åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®˜æ–¹è¿˜æ²¡æœ‰ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚\næˆ‘æ›¾ç»åœ¨è®ºå›æå‡ºè¿™ä¸ªé—®é¢˜ï¼ŒArkTS è®¡ç®—å¯†é›†ä»»åŠ¡ï¼ˆXORè¿ç®—ï¼‰æ•ˆç‡ä½ä¸‹ï¼ŒåŒæ—¶ä¹Ÿåœ¨å·¥å•ç³»ç»Ÿæé—®ï¼Œä½†æœ€åçš„ç»“è®ºæ˜¯ï¼Œå¿…é¡»æŠŠç›¸å…³ä»£ç åˆ‡æ¢åˆ° Native å®ç°ï¼ŒAOTå½“å‰æ˜¯æ— æ³•å¯ç”¨çš„ï¼ˆæ›´ä¸ç”¨è¯´JITï¼‰ã€‚\nå¦ä¸€æ–¹é¢ï¼Œåä¸ºä¹Ÿåœ¨æ¨å¹¿ Cangjie ä½œä¸º ArkTS çš„æ¥ç­äººï¼Œä½†ä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼ŒCangjie çš„å®¡ç¾æ¯” TypeScript æˆ–è€… Rust éƒ½å·®è¿œäº†ï¼Œè€Œä¸”å®ƒçš„æ–‡æ¡£ä¹Ÿæ˜¯ä¸€å›¢ç³Ÿï¼ŒAPI ä¹Ÿè¿˜æ²¡æœ‰å’Œ ArkTS ä¿æŒä¸€è‡´ï¼Œè°çˆ±ç”¨è°ç”¨å§ â•®(â•¯â–½â•°)â•­\nå…ƒæœåŠ¡ Native å¼€å‘ä¸ Native æ–¹æ³•è°ƒç”¨ å…ƒæœåŠ¡æ˜¯ä¸å…è®¸åˆ›å»º Native Module çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½åœ¨ å…ƒæœåŠ¡é¡¹ç›® é‡Œåˆ›å»º/ç¼–è¯‘å« Native ä»£ç çš„ HAR/HSP moduleã€‚ä½†æ˜¯ï¼Œå…ƒæœåŠ¡å¯ä»¥é€šè¿‡å¼•ç”¨ HAR/HSP æ¨¡å—ï¼Œè°ƒç”¨ Native æ–¹æ³• â€¦â€¦ å¾ˆæ˜æ˜¾æ‰€è°“ä¸èƒ½åˆ›å»º Native Moduleåªæ˜¯ DevEco Studio çš„ç¼ºé™·ï¼Œå…ƒæœåŠ¡çš„åœ°ä½ä¹‹ä½å¯è§ä¸€æ–‘ã€‚\nåœ¨å…ƒæœåŠ¡é‡Œè°ƒç”¨ Native æ–¹æ³•ï¼Œéœ€è¦æ³¨æ„ï¼šå¯¹äºå«æœ‰ Native æ¨¡å—çš„ HAR/HSP æ¨¡å—ï¼Œå…ƒæœåŠ¡ä¸èƒ½é€šè¿‡ åœ¨çº¿ æ–¹å¼å¼•ç”¨ï¼Œè€Œéœ€è¦æŠŠå¯¹åº”çš„åº“æ”¾åœ¨æœ¬åœ°ï¼Œç„¶åé€šè¿‡æœ¬åœ°å¼•ç”¨çš„æ–¹å¼æ¥è°ƒç”¨ï¼Œä¸ç„¶ä¼šæ— æ³•æ‰¾åˆ° NAPI æš´éœ²çš„æ–¹æ³•ï¼ŒæŠ¥é”™å¦‚ï¼šthe requested module '@normalized:Y\u0026amp;\u0026amp;\u0026amp;libscrypt.so\u0026amp;' does not provide an export name 'parallelROMix' which imported by '\u0026amp;scrypt/src/main/ets/scrypt\u0026amp;2.0.0'ã€‚ è€Œç¥å¥‡çš„æ˜¯ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œåˆ™å®Œå…¨æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚\nè¿™ä¸ªé—®é¢˜æˆ‘ä¹Ÿæè¿‡å·¥å•äº†ï¼Œå°±æ˜¯åˆ°ç°åœ¨è¿˜æ²¡äººç† ğŸ˜… å¿ƒè·¯å†ç¨‹ è¿™ä¸ªåæ§½éƒ¨åˆ†æ”¾åœ¨æœ€åï¼Œåªæ˜¯æ¥çœ‹æŠ€æœ¯çš„è¯»è€…å¯ä»¥ç›´æ¥è·³è¿‡ã€‚\n2024å¹´12æœˆ31æ—¥å‰ï¼ŒHarmonyOS NEXTçš„ç”Ÿæ€è¿›å±•åªæœ‰ä¸€ä¸ªä¸»æ—‹å¾‹ï¼šå†²é‡ã€‚\nä¼ä¸šå¼€å‘è€…æ–¹é¢ï¼š å…ˆæ˜¯å¨é€¼åˆ©è¯±å¤´éƒ¨å‚å•†ï¼Œåšå‡º99%çš„æ—¥å¸¸åº”ç”¨ï¼›ç„¶åä¸Šæ¶ å“æ˜“é€š/å‡ºå¢ƒæ˜“ å®‰å“è™šæ‹Ÿæœºï¼Œè¡¥é½å‰©ä¸‹çš„å°ä¼—è½¯ä»¶å¢ƒå¤–è½¯ä»¶ã€‚\nä¸ªäººå¼€å‘è€…æ–¹é¢ï¼š å¼€å‘è€…æ¿€åŠ±è®¡åˆ’ï¼Œæ”¾å‡ºå¤§é‡çº¢åˆ©ï¼Œå¸å¼•å¤§æ•°é‡åº”ç”¨ä¸Šæ¶ï¼ˆå³ä½¿å¤§éƒ¨åˆ†ç²—åˆ¶æ»¥é€ ï¼‰ï¼Œå…ƒæœåŠ¡ä¸Šæ¶ç”šè‡³ä¸éœ€è¦è½¯è‘—å’Œå¤‡æ¡ˆï¼›ç„¶åå†æé«˜é—¨æ§›ï¼ŒæŠŠä¸Šè½¦æ™šçš„æ— æ³•å¼•æµçš„åƒåœ¾å…ƒæœåŠ¡ä¸‹æ¶ï¼Œçœä¸€ç‚¹æ˜¯ä¸€ç‚¹ã€‚å¦ä¸€æ–¹é¢ï¼Œå®˜æ–¹çš„å¼€å‘è€…è”ç›Ÿè®ºå›ç›´åˆ°ä»Šå¤©ä¸ºæ­¢ï¼Œä»ç„¶æœ‰å¤§é‡ç–‘ä¼¼å®˜æ–¹çš„æ°´å†›è´¦å·å¤§é‡å¤åˆ¶ç²˜è´´è‡ªå¯¼è‡ªæ¼”çš„å‘å¸–ï¼ŒæŠŠæ­£å¸¸çš„è™½ç„¶æ¯”è¾ƒå°‘çš„æ­£å¸¸å¼€å‘è€…çš„è®¨è®ºä¸æé—®æ·¹æ²¡ã€‚\næ¶ˆè´¹è€…æ–¹é¢ï¼š å…ˆæ˜¯å‘æ”¾å„ç§åˆä½œå‚å•†çš„ä¼šå‘˜æœˆå¡/å­£å¡ï¼Œå†æ˜¯ç›´æ¥é€é’±å……è¯è´¹ç”µè´¹äº¤é€šå¡ï¼›æœ€å24å¹´å¿«è¿‡å»äº†ï¼ŒAPI 14 å…ˆæ”¯æŒ Nova 12/13 ç”¨æˆ·å‡çº§éœ€æ±‚ï¼Œèƒ½æ‹‰ä¸€ç‚¹å‡çº§ç‡ç®—ä¸€ç‚¹ã€‚\nå¯ä»¥çœ‹å‡ºï¼Œåä¸ºçš„äººåŠ›å’Œè´¢åŠ›ï¼Œéƒ½èŠ±åœ¨äº†åœ¨2024å¹´ç»“æŸå‰å®Œæˆ è½¬åŒ–ç‡ ç•™å­˜ç‡ æ´»è·ƒåº¦ KPIä¸Šï¼›è‡³äºç”Ÿæ€çš„è´¨é‡ä»¥åŠåç»­å‘å±•ï¼ŒçœŸä¸å¥½è¯´è¿™æ˜¯å¦ç®—æ­£é¢çš„å½±å“ã€‚\nè¿™ä¸€åˆ‡çš„è¡Œä¸ºå¯¼å‘ï¼Œè®©æˆ‘åœ¨å¼€å‘è¿™ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œä¸æ–­æ„Ÿå—åˆ°æ— åŠ›ä¸è¢«æ­§è§†ã€‚é¦–å…ˆï¼ŒAPI 13/14 çš„æ¨å‡ºï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸ºäº†æœåŠ¡å¤´éƒ¨å‚å•†ï¼ˆæ¯”å¦‚å¾®ä¿¡ï¼‰çš„åé¦ˆï¼ˆAPI 13ï¼‰ï¼Œä»¥åŠæé«˜ç”¨æˆ·çš„å‡çº§ç‡çš„éœ€æ±‚ï¼ˆAPI 14ï¼‰ï¼Œä¸ªäººå¼€å‘è€…åé¦ˆçš„é—®é¢˜å‡ ä¹ä¸èƒ½å¾—åˆ°ä¿®å¤ï¼Œæ¯”å¦‚ HUKS çš„å„ç§æ–‡æ¡£ç¼ºå¤±ä»¥åŠ ArkTS çš„æ•ˆç‡ä½ä¸‹ã€‚\nå…¶æ¬¡ï¼Œå…ƒæœåŠ¡çš„ç”Ÿæ€åœ°ä½å ªå¿§ï¼Œè™½ç„¶å®˜æ–¹ä¸€ç›´åœ¨å¼ºè°ƒå…ƒæœåŠ¡ä¸æ™®é€šåº”ç”¨ä¸€ä½“ä¸¤é¢ï¼Œèƒ½ç»™ç”¨æˆ·å¸¦æ¥æ›´ç‹¬ç‰¹çš„ä½“éªŒï¼Œä½†æˆªè‡³ç›®å‰ä¸ºæ­¢ï¼Œå…ƒæœåŠ¡ç®€ä»‹å†…å®¹ä¸èƒ½è¢«åº”ç”¨å¸‚åœºç´¢å¼•ï¼Œæ›¾ä¸€åº¦è¢«ç¦æ­¢ä¸Šæ¶å…¬å¼€æµ‹è¯•ï¼ˆä¸€ä¸ªå¾ˆå¥½å…è´¹çš„è·æµæ¸ é“ç›´åˆ°è¢«åƒåœ¾å…ƒæœåŠ¡å¼€å‘è€…æ»¥ç”¨ï¼‰ï¼Œä¸èƒ½ä½¿ç”¨é¸¿è’™ç¢°ä¸€ç¢°åˆ†äº«ï¼ˆShareKitï¼‰ï¼Œä¸èƒ½æ¥å…¥æ„å›¾æ¡†æ¶ï¼Œå¡ç‰‡åŠ æ¡ŒAPIå­˜åœ¨ç¼ºé™·ä¸èƒ½è§¦å‘åˆ·æ–°ï¼Œå•†åº—å®¡æ ¸è¢«å…¶ä»–åº”ç”¨æ’é˜Ÿ â€¦â€¦ ç­‰ç­‰è¯¸å¤šé™åˆ¶ï¼Œåªèƒ½çœ‹å‡ºå®˜æ–¹å¯¹å…ƒæœåŠ¡ç”Ÿæ€çš„æ¼ è§†ã€‚ å¤§æ¦‚â€œå¾…åˆ°å±±èŠ±çƒ‚æ¼«æ—¶â€ï¼Œå…ƒæœåŠ¡ä¹Ÿå°±ç®—ä¸ªè‚¥æ–™ç½¢äº†ï¼ŒçœŸä¸çŸ¥é“å‘çš„ 300 å—å…ƒæœåŠ¡ä¼˜æƒ åˆ¸åˆ°åº•è‚¥äº†è°çš„é’±åŒ…ã€‚\næ€»è€Œè¨€ä¹‹ï¼Œç»å†äº†è¿™ä¹ˆå¤šæ³¢æŠ˜ï¼Œæˆ‘è¿˜æ˜¯å®Œæˆäº†è¿™ä¸ªé¡¹ç›®ã€‚ç­‰è¿™æ³¢æ’’é’±/éª—é’±çš„çƒ­åº¦è¿‡å»ï¼Œå†çœ‹çœ‹é¸¿è’™ç”Ÿæ€çš„æœªæ¥åœ¨å“ªé‡Œå§ï¼Œè‡³å°‘æˆ‘ç°åœ¨å¯¹å®ƒæ˜¯ååˆ†å¤±æœ›çš„ï¼ˆæ‰‹æŒ HUAWEI Pura 70 Pro Plus å…‰ç»‡é“¶ 16+512GB åŸä»·è´­å…¥ç”¨æˆ· ä½œç­” ğŸ˜…ï¼‰ã€‚\n","date":"2024-12-31T19:00:00+08:00","image":"https://sudofree.xyz/p/developer-log-aigis-authenticator-for-harmonyos-next/screenshot-preview_hu16647423754353517212.png","permalink":"https://sudofree.xyz/p/developer-log-aigis-authenticator-for-harmonyos-next/","title":"å¼€å‘æ—¥å¿—ï¼šAigis Authenticator for HarmonyOS NEXT"},{"content":"Retrohos çš„ç›®æ ‡æ˜¯ä½œä¸º OpenHarmony/HarmonyOS ä¸Š RetroArch Frontend çš„å®ç°ä»¥åŠå®Œæˆå„ç¤¾åŒº Emulator æ ¸å¿ƒçš„ç§»æ¤ï¼Œå¹¶åŒæ—¶æ”¯æŒé¸¿è’™æ¡†æ¶å…³äºåˆ†å¸ƒå¼åº”ç”¨çš„æ„¿æ™¯ï¼ˆå¦‚å¤§å±æ˜¾ç¤ºåŒæ—¶æ‰‹æœºä½œä¸ºæ‰‹æŸ„çš„ä½“éªŒï¼‰ã€‚ ç”±äºæœ¬äººä¹‹å‰åªæœ‰ç²—æµ…çš„ Android ç§»åŠ¨ç«¯å¼€å‘ç»éªŒï¼ˆé€šè¿‡NDKæ§åˆ¶AndroidæŠ•å±ï¼‰ï¼Œæœ¬æ—¥å¿—ä»…ä½œä¸ºåº”ç”¨å¼€å‘æ¢ç´¢è¿‡ç¨‹ä¸­çš„è®°å½•ï¼Œå¹¶éæœ€ä½³å®ç°ï¼Œä»…ä¾›å‚è€ƒã€‚\nä»€ä¹ˆæ˜¯ Libretro RetroArch æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„æ€€æ—§æ¸¸æˆä¸»æœºè§£å†³æ–¹æ¡ˆã€‚å®ƒæœ¬èº«å¹¶ä¸æä¾›ä»»ä½•ä»¿çœŸå™¨çš„åŠŸèƒ½ åªæ˜¯å¤§è‡ªç„¶çš„æ¬è¿å·¥ï¼Œåªæ˜¯æä¾›äº†èšåˆç¤¾åŒºä»¿çœŸå™¨ï¼ˆEmulator Coreï¼‰çš„å¹³å°ï¼Œä»¥åŠä¸€ä¸ªé€šç”¨çš„æ¥å…¥æ¥å£å®šä¹‰ Libretroã€‚ä»¥ä¸‹ç®€ä»‹ç”Ÿæˆè‡ª ChatGPT :\nLibretro æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ¸¸æˆæœºæ¨¡æ‹Ÿå™¨æ ¸å¿ƒæ¡†æ¶ï¼Œé€šè¿‡ Libretro APIï¼Œå¯ä»¥å°†æ¸¸æˆæ ¸å¿ƒï¼ˆCoreï¼‰ä¸å‰ç«¯ï¼ˆFrontendï¼‰åˆ†ç¦»ï¼Œå®ç°æ ¸å¿ƒçš„è·¨å¹³å°ç§»æ¤ï¼ŒåŒæ—¶æ”¯æŒå¤šç§å‰ç«¯ï¼Œå¦‚ RetroArchã€Lakka ç­‰ã€‚Libretro æ ¸å¿ƒæ˜¯ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œé€šè¿‡è°ƒç”¨ Libretro APIï¼Œå¯ä»¥å®ç°æ¸¸æˆæ ¸å¿ƒçš„åˆå§‹åŒ–ã€è¾“å…¥è¾“å‡ºã€éŸ³é¢‘è§†é¢‘æ¸²æŸ“ç­‰åŠŸèƒ½ã€‚\nLibretro å¾ˆå¥½åœ°å°†æ¨¡æ‹Ÿå™¨çš„æ„æˆåŒºåˆ†å¼€æ¥ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å¿½ç•¥ç°æœ‰å‰ç«¯çš„å®ç°ï¼ˆä»¥åŠå„å¼‚çš„GUIæŠ€æœ¯æ ˆï¼‰ï¼Œä¸“æ³¨äºæ ¸å¿ƒçš„ç§»æ¤ä»¥åŠä¸ç³»ç»Ÿçš„å¯¹æ¥ã€‚å› æ­¤ Retrohos é¡¹ç›®çš„ç›®æ ‡æ˜¯å°†å®ç°ä¸€ä¸ªå…¼å®¹ Libretro API çš„å‰ç«¯ï¼ŒåŒæ—¶ç§»æ¤ç¤¾åŒºçš„ Emulator Coreï¼Œè€Œé RetroArch çš„å®Œæ•´ç§»æ¤ã€‚\nå‡†å¤‡ NDK ç¯å¢ƒ ç›®å‰å…³äº OpenHarmony çš„å¼€å‘ï¼Œæœ¬äººæ¨èç›´æ¥ä½¿ç”¨ HarmonyOS å•†ä¸šå‘è¡Œç‰ˆä»¥åŠåä¸ºæä¾›çš„å¼€å‘è€…å†…æµ‹SDKï¼Œè€Œéç¤¾åŒºå¼€æºçš„ OpenHarmony ç‰ˆæœ¬ï¼›è™½ç„¶ä¸¤è€…ç›®å‰å·®å¼‚åº¦ä¸å¤§ï¼ˆHarmonyOS Next Beta1 åŸºäº OpenHarmony 5.0.0.xxï¼‰ï¼Œä½†ç›®å‰å”¯ä¸€å¯ç”¨ä¸”æˆç†Ÿçš„ç”Ÿæ€ç¯å¢ƒåªæœ‰ HarmonyOSï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å¾—ä¸æ¥å—çš„ç°çŠ¶ã€‚ ä½†å¥½åœ¨ OpenHarmony NDK å¼€å‘ä¸ Android ç±»ä¼¼ï¼Œå¹¶ä¸éœ€è¦ä¾èµ–å®˜æ–¹æä¾›çš„IDEï¼ˆDevEco Studioï¼‰ï¼›ä»¥ä¸‹çš„å¼€å‘å†…å®¹å°†ä»¥å‘½ä»¤è¡Œå·¥å…·ä¸ºåŸºç¡€ï¼Œåœ¨ Linux å¹³å°ï¼ˆUbuntu 22.04.3 LTSï¼‰ä¸Šè¿›è¡Œã€‚\nä»¥å½“å‰æœ€æ–°çš„å®˜æ–¹Linuxç‰ˆæœ¬SDKï¼ˆ5.0.0.800ï¼‰ä¸ºä¾‹ï¼Œä»¥ä¸‹å‡è®¾ commandline-tools.zip å‹ç¼©åŒ…å·²ç»ä¸‹è½½å¹¶è§£å‹åˆ° $HOME ç›®å½•ä¸‹ï¼›ä¸ºäº†æ–¹ä¾¿åŒºåˆ†ç‰ˆæœ¬å·ï¼Œå°†è§£å‹åçš„ç›®å½•é‡æ–°å‘½åä¸º command-line-tools/5.0.0.800ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»º env.sh æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 #!/bin/bash export OHOS_ROOT=$HOME/command-line-tools/5.0.3.800 export SDK_ROOT=$OHOS_ROOT/sdk/default/openharmony ## export NDK Path export NDK_ROOT=$SDK_ROOT/native export PATH=$NDK_ROOT/build-tools/cmake/bin:$PATH export PATH=$NDK_ROOT/llvm/bin:$PATH ## export OHOS command line tools export PATH=$OHOS_ROOT/tool/node/bin:$PATH export PATH=$OHOS_ROOT/bin:$PATH ä¹‹ååœ¨ä½¿ç”¨æ—¶ï¼Œåªéœ€æ‰§è¡Œ source env.sh å³å¯ã€‚è¯¥æ–‡ä»¶ä¸»è¦èµ·åˆ°ä»¥ä¸‹ä½œç”¨ï¼š\nè®¾ç½®SDKç›¸å…³ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œå˜é‡åç§°æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿åç»­å¼•ç”¨ï¼› $NDK_ROOT æŒ‡å‘ NDK çš„æ ¹ç›®å½•ï¼Œæ–¹ä¾¿åç»­å¼•ç”¨ç¼–è¯‘é“¾å·¥å…·ï¼Œä»¥åŠé“¾æ¥ sysrootï¼› $PATH ä¸­å‰ç½®æ·»åŠ äº† cmake å’Œ llvm çš„è·¯å¾„ï¼Œä¼šè¦†ç›–æ‰ç³»ç»Ÿé»˜è®¤çš„ç¼–è¯‘å·¥å…·é“¾ï¼Œ ä»¥ç¡®ä¿ä½¿ç”¨ NDK æä¾›çš„å·¥å…·é“¾ã€‚ å¦å¤–æ ¹æ®å®˜æ–¹NDKå¼€å‘æ–‡æ¡£ï¼Œåœ¨è°ƒç”¨ NDK æä¾›çš„ cmake ç¼–è¯‘æ—¶ï¼Œéœ€è¦ä¼ å…¥ä»¥ä¸‹å‚æ•°ï¼ˆä»¥ aarch64-linux-ohos ä¸ºä¾‹ï¼‰ï¼š\n1 cmake -DOHOS_STL=c++_shared -DOHOS_ARCH=arm64-v8a -DOHOS_PLATFORM=OHOS -DCMAKE_TOOLCHAIN_FILE=${NDK_ROOT}/build/cmake/ohos.toolchain.cmake . å…¶ä¸­ CMAKE_TOOLCHAIN_FILE æœ€ä¸ºé‡è¦ï¼ŒæŒ‡å®šäº†ç¼–è¯‘é“¾çš„é…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¼šè‡ªåŠ¨é“¾æ¥ NDK æä¾›çš„ sysrootã€‚\nç§»æ¤ Libretro æ ¸å¿ƒ libretro-super ç§»æ¤å°è¯• libretro/libretro-super ä»“åº“æ˜¯ä¸€ä¸ªç”¨äºç®¡ç† Libretro æ ¸å¿ƒä»¥åŠ RetroArch åœ¨ä¸åŒå¹³å°ç¼–è¯‘è„šæœ¬çš„ç®¡ç†é¡¹ç›®ï¼Œå…¶æŒ‰ç…§ target triplet æ ‡è¯†ä¸ç»„ç»‡ä¸åŒå¹³å°ä¸‹çš„æ„å»ºæµç¨‹ã€‚ æœ€åˆï¼Œæˆ‘ä»¥ä¸º OpenHarmony åº•å±‚ä¸è¿‡æ˜¯ Linux kernel çš„ aarch64 æ¶æ„ï¼Œå·¥å…·é“¾ä¸­çš„åŠ¨æ€åº“ä¹Ÿéƒ½å¾ˆå¸¸è§ï¼Œä¸ SDKå…³ç³»ä¸å¤§ï¼Œå› æ­¤å°è¯•ç›´æ¥ç§»æ¤è¿™ä¸ªè¶…çº§é¡¹ç›®ã€‚ç„¶è€Œå¯æƒœçš„æ˜¯ï¼Œç”±äº ohos / OHOS æ ‡è¯†å¹¶éä¼—å¤šä¸Šæ¸¸ä¾èµ–æ”¯æŒçš„å¹³å°ï¼Œå¹¶ä¸”å®ƒä¹Ÿä¸ä¼šè¢«è‡ªåŠ¨é™çº§åˆ° aarch64 Linux çš„æ„å»ºæµç¨‹ä¸­ï¼Œæš´åŠ›ç§»æ¤åªä¼šé™·å…¥åˆ°æ— é™çš„ä¾èµ–è§£å†³ä¸­ã€‚\nå› æ­¤æœ€åˆé€‚çš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ä»…é‡‡ç”¨ Libretro Core çš„æ„å»ºæµç¨‹ï¼ˆé€ä¸ª Fork ä»“åº“è¿›è¡Œä¿®æ”¹ğŸ˜“ï¼‰ï¼ŒæŠ›å¼ƒ libretro-super è¿™ä¸ªè¿‡äºæ‚ä¹±çš„é¡¹ç›®çš„æ•´ä½“ç§»æ¤ã€‚åœ¨æœ¬é¡¹ç›®çš„å¯åŠ¨é˜¶æ®µï¼Œæˆ‘ä»¬èšç„¦äº ppsspp æ ¸å¿ƒçš„ç§»æ¤ï¼šå®ƒæœ¬èº«æä¾›äº† ppsspp-libretro çš„åŠ¨æ€åº“æ„å»ºé€‰é¡¹ï¼Œä¸‰æ–¹ä¾èµ–è¾ƒå°‘ï¼Œæ˜¯ç¬¬ä¸€ä¸ªæˆåŠŸæ„å»ºçš„æ ¸å¿ƒã€‚\nç¼–è¯‘ ppsspp-libretro æ ¸å¿ƒ ppsspp-ffmpeg é™æ€åº“æ„å»º hrydgard/ppsspp é€šè¿‡ .gitmodules å¼•å…¥äº†å¤šä¸ªä¸‰æ–¹ä¾èµ–ï¼Œå…¶ä¸­åªæœ‰å…¶è‡ªå·±ç»´æŠ¤çš„ hrydgard/ppsspp-ffmpeg éœ€è¦é¢å¤–å¤„ç† OHOS æ¶æ„å­—ç¬¦ä¸²çš„æ·»åŠ ï¼Œå‚è€ƒ android_arm64_v8a.sh å¹¶å¯¹åº”æ·»åŠ  ohos_arm64-v8a.sh æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 #!/bin/bash if [ \u0026#34;$NDK_ROOT\u0026#34; = \u0026#34;\u0026#34; ]; then echo \u0026#34;Please set NDK_ROOT to your OpenHarmony NDK location.\u0026#34; exit 1 fi NDK_PLATFORM=\u0026#34;aarch64-linux-ohos\u0026#34; NDK_PLATFORM_LIB=$NDK_ROOT/sysroot/usr/lib/$NDK_PLATFORM NDK_PREBUILTLLVM=$NDK_ROOT/llvm set -e GENERAL=\u0026#34;\\ --enable-cross-compile \\ --enable-pic \\ --cc=$NDK_PREBUILTLLVM/bin/clang \\ --cross-prefix=$NDK_PREBUILTLLVM/bin/aarch64-unknown-linux-ohos- \\ --ar=$NDK_PREBUILTLLVM/bin/llvm-ar \\ --ld=$NDK_PREBUILTLLVM/bin/clang \\ --nm=$NDK_PREBUILTLLVM/bin/llvm-nm \\ --ranlib=$NDK_PREBUILTLLVM/bin/llvm-ranlib\u0026#34; MODULES=\u0026#34;\\ --disable-avdevice \\ --disable-filters \\ --disable-programs \\ --disable-network \\ --disable-avfilter \\ --disable-postproc \\ --disable-encoders \\ --disable-protocols \\ --disable-hwaccels \\ --disable-doc\u0026#34; VIDEO_DECODERS=\u0026#34;\\ --enable-decoder=h264 \\ --enable-decoder=mpeg4 \\ --enable-decoder=mpeg2video \\ --enable-decoder=mjpeg \\ --enable-decoder=mjpegb\u0026#34; AUDIO_DECODERS=\u0026#34;\\ --enable-decoder=aac \\ --enable-decoder=aac_latm \\ --enable-decoder=atrac3 \\ --enable-decoder=atrac3p \\ --enable-decoder=mp3 \\ --enable-decoder=pcm_s16le \\ --enable-decoder=pcm_s8\u0026#34; DEMUXERS=\u0026#34;\\ --enable-demuxer=h264 \\ --enable-demuxer=m4v \\ --enable-demuxer=mpegvideo \\ --enable-demuxer=mpegps \\ --enable-demuxer=mp3 \\ --enable-demuxer=avi \\ --enable-demuxer=aac \\ --enable-demuxer=pmp \\ --enable-demuxer=oma \\ --enable-demuxer=pcm_s16le \\ --enable-demuxer=pcm_s8 \\ --enable-demuxer=wav\u0026#34; VIDEO_ENCODERS=\u0026#34;\\ --enable-encoder=huffyuv --enable-encoder=ffv1\u0026#34; AUDIO_ENCODERS=\u0026#34;\\ --enable-encoder=pcm_s16le\u0026#34; MUXERS=\u0026#34;\\ --enable-muxer=avi\u0026#34; PARSERS=\u0026#34;\\ --enable-parser=h264 \\ --enable-parser=mpeg4video \\ --enable-parser=mpegaudio \\ --enable-parser=mpegvideo \\ --enable-parser=aac \\ --enable-parser=aac_latm\u0026#34; function build_arm64 { # no-missing-prototypes because of a compile error seemingly unique to aarch64. ./configure --logfile=conflog.txt --target-os=linux \\ --prefix=./ohos/arm64 \\ --arch=aarch64 \\ ${GENERAL} \\ --extra-cflags=\u0026#34; --target=aarch64-linux-ohos -no-canonical-prefixes -fdata-sections -ffunction-sections -fno-limit-debug-info -funwind-tables -fPIC -O2 -DOHOS -DOHOS_ARCH=arm64-v8a -DOHOS_PLATFORM=OHOS -DCMAKE_TOOLCHAIN_FILE=${NDK_ROOT}/build/cmake/ohos.toolchain.cmake -Dipv6mr_interface=ipv6mr_ifindex -fasm -fno-short-enums -fno-strict-aliasing -Wno-missing-prototypes\u0026#34; \\ --disable-shared \\ --enable-static \\ --extra-ldflags=\u0026#34; -B$NDK_PREBUILTLLVM/bin/aarch64-unknown-linux-ohos- --target=aarch64-linux-ohos -Wl,--rpath-link,$NDK_PLATFORM_LIB -L$NDK_PLATFORM_LIB -nostdlib -lc -lm -ldl\u0026#34; \\ --enable-zlib \\ --disable-everything \\ ${MODULES} \\ ${VIDEO_DECODERS} \\ ${AUDIO_DECODERS} \\ ${VIDEO_ENCODERS} \\ ${AUDIO_ENCODERS} \\ ${DEMUXERS} \\ ${MUXERS} \\ ${PARSERS} make clean make -j4 install } build_arm64 é€šè¿‡ä¹‹å‰æåˆ°çš„ source env.sh å‡†å¤‡å¥½ NDK ç¯å¢ƒåï¼Œéšåæ‰§è¡Œè¯¥æ„å»ºè„šæœ¬ï¼Œåœ¨ ohos/arm64 ä¸‹ç”Ÿæˆ libavcodec.a ç­‰é™æ€åº“æ–‡ä»¶ï¼Œä»¥åŠ include ç›®å½•ä¸‹çš„å¤´æ–‡ä»¶ã€‚ æäº¤ç›¸å…³æ›´æ”¹åï¼Œå³å¯åœ¨ ppsspp-libretro ä¸­å°† submodule æŒ‡å‘æˆ‘ä»¬ä¿®æ”¹åçš„ä»“åº“ Retrohos/ppsspp-ffmpeg.\nppsspp æ„å»º ppsspp-libretro æœ¬èº«çš„ç§»æ¤è¾ƒä¸ºç®€å•ï¼Œåªéœ€è¦åœ¨ CMakeLists.txt ä¸­æ·»åŠ  OHOS æ¶æ„çš„åˆ¤æ–­ï¼Œä»¥åŠä¿®æ”¹ CMakeLists.txt ä¸­çš„ç¼–è¯‘é€‰é¡¹ï¼Œpatch å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 diff --git a/CMakeLists.txt b/CMakeLists.txt index ad2be076b..2fe1e619c 100644 --- a/CMakeLists.txt +++ b/CMakeLists.txt @@ -99,8 +99,12 @@ if(${CMAKE_SYSTEM_NAME} MATCHES \u0026#34;Android\u0026#34;) set(ANDROID ON) endif() +if(${CMAKE_SYSTEM_NAME} MATCHES \u0026#34;OHOS\u0026#34;) +\tset(OHOS ON) +endif() + # We only support Vulkan on Unix, macOS (by MoltenVK), Android and Windows. -if(ANDROID OR WIN32 OR (UNIX AND NOT ARM_NO_VULKAN)) +if(OHOS OR ANDROID OR WIN32 OR (UNIX AND NOT ARM_NO_VULKAN)) set(VULKAN ON) endif() @@ -192,7 +196,7 @@ if(USE_CCACHE) include(ccache) endif() -if(UNIX AND NOT (APPLE OR ANDROID) AND VULKAN) +if(UNIX AND NOT (APPLE OR ANDROID OR OHOS) AND VULKAN) if(USING_X11_VULKAN) message(\u0026#34;Using X11 for Vulkan\u0026#34;) find_package(X11) @@ -225,7 +229,7 @@ if(LIBRETRO) endif() endif() -if(ANDROID) +if(ANDROID OR OHOS) set(MOBILE_DEVICE ON) set(USING_GLES2 ON) endif() @@ -382,7 +386,7 @@ if(NOT MSVC) # NEON optimizations in libpng17 seem to cause PNG load errors, see #14485. add_definitions(-DPNG_ARM_NEON_OPT=0) -\tif(ANDROID) +\tif(ANDROID OR OHOS) set(CMAKE_CXX_FLAGS \u0026#34;${CMAKE_CXX_FLAGS} -std=gnu++17\u0026#34;) endif() if(CLANG) @@ -474,7 +478,7 @@ if(NOT MSVC) if(${CMAKE_SYSTEM_NAME} STREQUAL \u0026#34;NetBSD\u0026#34;) add_definitions(-D_NETBSD_SOURCE) endif() -\telseif(ANDROID) +\telseif(ANDROID OR OHOS) add_definitions(-fsigned-char) endif() else() @@ -943,6 +947,10 @@ if(USE_FFMPEG) elseif(X86) set(PLATFORM_ARCH \u0026#34;android/x86\u0026#34;) endif() +\telseif(OHOS) +\tif(ARM64) +\tset(PLATFORM_ARCH \u0026#34;ohos/arm64\u0026#34;) +\tendif() elseif(IOS) if(IOS_PLATFORM STREQUAL \u0026#34;TVOS\u0026#34;) set(PLATFORM_ARCH \u0026#34;tvos/arm64\u0026#34;) @@ -1200,7 +1208,7 @@ else() endif() # Arm platforms require at least libpng17. -if(ANDROID OR ARMV7 OR ARM64 OR ARM OR IOS) +if(OHOS OR ANDROID OR ARMV7 OR ARM64 OR ARM OR IOS) set(PNG_REQUIRED_VERSION 1.7) else() set(PNG_REQUIRED_VERSION 1.6) ä¿®æ”¹å®Œæˆåæ‰§è¡Œ\n1 cmake -DOHOS_STL=c++_shared -DOHOS_ARCH=arm64-v8a -DOHOS_PLATFORM=OHOS -DCMAKE_TOOLCHAIN_FILE=${NDK_ROOT}/build/cmake/ohos.toolchain.cmake -DLIBRETRO=ON -DUSING_EGL=ON -DUSING_GLES2=ON . -Bbuild åˆ›å»º build ç›®å½•ï¼Œå¹¶åœ¨å…¶ä¸­æ‰§è¡Œ make -j4 å³å¯ç”Ÿæˆ lib/ppsspp_libretro.so æ–‡ä»¶ã€‚\nåç»­è®¡åˆ’ ä½œä¸ºé¡¹ç›®çš„å¯åŠ¨é˜¶æ®µï¼Œä¸€ä¸ªæ ¸å¿ƒçš„ç§»æ¤å·²ç»è¶³å¤Ÿæˆ‘ä»¬è¿›è¡Œåç»­çš„å‰ç«¯å¼€å‘ã€‚æ¥ä¸‹æ¥è®¡åˆ’å…ˆè®¾è®¡ä¸€ä¸ªç®€å•çš„ Libretro å‰ç«¯ï¼Œå¹¶é€šè¿‡ ArkTS NAPI è¿›è¡Œç»‘å®šè°ƒç”¨ï¼Œå¿«é€Ÿå®ç° framebuffer çš„è¾“å‡ºã€‚è‡³äºæ›´ä¸ºé‡è¦çš„ GUI è®¾è®¡ï¼Œå¯ä»¥å†ç­‰ç­‰ DevEco Studio å¼€å‘å¥—ä»¶çš„å®Œå–„(ï½oï¿£3ï¿£)ï½\n","date":"2024-09-07T22:14:46+08:00","image":"https://sudofree.xyz/p/retrohos-development-logs-01-migrating-libretro-cores/ppsspp-libretro-core_hu15084682474071154973.png","permalink":"https://sudofree.xyz/p/retrohos-development-logs-01-migrating-libretro-cores/","title":"Retrohos å¼€å‘æ—¥å¿—å…¶ä¸€: ç§»æ¤ Libretro Cores"},{"content":" ä»¥ä¸‹å†…å®¹ä½¿ç”¨ deepl.com æœºç¿»è¾…åŠ©ï¼Œå¦‚æœ‰ä¸é€‚è¯·å‚è€ƒè‹±æ–‡ç‰ˆæœ¬ã€‚\næˆ‘å¾ˆå¥‡æ€ªä¸ºä»€ä¹ˆæ²¡æœ‰äººå‘ç°è¿™ä¸ªå†…å­˜æ³„æ¼é—®é¢˜ã€‚ä¹Ÿè®¸æ˜¯æˆ‘å¤ªæ‡’äº†ï¼Œæ²¡æœ‰åœ¨ç½‘ä¸Šç¿»åˆ°ã€‚ æ€»ä¹‹ï¼Œæˆ‘å‘ç°åœ¨åŸå§‹å®ç°ä¸­å­˜åœ¨æ˜æ˜¾çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼ˆå…¶æºä»£ç å¯åœ¨ Github ä¸Šè·å–ï¼‰ã€‚\næˆ‘åœ¨åŠ è½½ä¸€ä¸ªå¤§å‹æ•°æ®é›†æ—¶å‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œè¯¥æ•°æ®é›†åŒ…å«çº¦ 600 çš„å›¾åƒå’Œ 400 ä¸‡çš„ç‚¹äº‘æ•°æ®ï¼Œè¿™äº›å›¾åƒå’Œç‚¹æ˜¯é€šè¿‡ç²¾ç¡®çš„å‡ ä½•æ˜ å°„æ”¶é›†çš„ã€‚è®­ç»ƒæ—¶å ç”¨äº†NVIDIA RTX 3090 GPU 20GB ä»¥ä¸Šçš„æ˜¾å­˜ï¼ŒåŒæ—¶è¿˜å ç”¨äº† 15GB ä»¥ä¸Šçš„å†…å­˜ã€‚è™½ç„¶åœºæ™¯ç¡®å®å¾ˆå¤§ï¼Œä½†æˆ‘å¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆä¸€å¼€å§‹å°±å ç”¨äº†æ‰€æœ‰å†…å­˜ï¼Œè€Œä¸æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­é€æ¸å¢åŠ ï¼\nç¬¬ä¸€ä¸ªè¡¥ä¸ - å»¶è¿ŸåŠ è½½ é¦–å…ˆï¼Œæˆ‘æ‰¾å‡ºäº† CPU å ç”¨å¤§é‡å†…å­˜ï¼ˆå³ RAM å ç”¨ï¼‰çš„åŸå› ï¼šä¸€å¼€å§‹ï¼Œæ‰€æœ‰å›¾åƒçš„éƒ½åœ¨ RAM ä¸­è¢«åŠ è½½ï¼Œå¹¶åœ¨ GPU ä¸Šåˆ›å»ºäº†ç›¸åº”çš„å¼ é‡ã€‚ç›¸å…³æºä»£ç è§ utils/camera_utils.py#L20ï¼š\n1 2 3 4 5 6 7 8 9 def loadCam(args, id, cam_info, resolution_scale, is_test_dataset): ... return Camera(resolution, colmap_id=cam_info.uid, R=cam_info.R, T=cam_info.T, FoVx=cam_info.FovX, FoVy=cam_info.FovY, depth_params=cam_info.depth_params, image=image, invdepthmap=invdepthmap, image_name=cam_info.image_name, uid=id, data_device=args.data_device, train_test_exp=args.train_test_exp, is_test_dataset=is_test_dataset, is_test_view=cam_info.is_test) æˆ‘çš„ç›´æ¥æƒ³æ³•æ˜¯è¿›è¡Œæƒè¡¡ï¼šå›¾åƒåŠ è½½æ—¶é—´å¯èƒ½ä¸å€¼å¾—æ¶ˆè€—è¿™ä¹ˆå¤šå†…å­˜ï¼Œå°¤å…¶æ˜¯è€ƒè™‘åˆ°åç»­çš„å·¨å¤§è®­ç»ƒè´Ÿæ‹…ã€‚ å› æ­¤ï¼Œæˆ‘ç¼–å†™äº†ä¸€ä¸ª LazyLoader ç±»ï¼Œå°† Camera ç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°ç¬¬ä¸€æ¬¡å¼•ç”¨ã€‚å®ç°ç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 from scene.cameras import Camera class LazyLoader: def __init__(self, cls, *args, **kwargs): self.cls = cls self.args = args self.kwargs = kwargs self.instance = None pass def __getattribute__(self, name: str): if name in [\u0026#39;cls\u0026#39;, \u0026#39;args\u0026#39;, \u0026#39;kwargs\u0026#39;, \u0026#39;instance\u0026#39;]: return super().__getattribute__(name) else: if not self.instance: self.instance = self.cls(*self.args, **self.kwargs) return getattr(self.instance, name) def __del__(self): if self.instance: del self.instance pass pass å› æ­¤ï¼ŒCamera ç±»æ„å»ºçš„åŸå§‹å¼•ç”¨ä¿®æ”¹ä¸º\n1 2 - return Camera(colmap_id=cam_info.uid, R=cam_info.R, T=cam_info.T, + return LazyLoader(Camera, colmap_id=cam_info.uid, R=cam_info.R, T=cam_info.T, åœ¨ train.py ä¸­çš„ä¸»è®­ç»ƒå¾ªç¯ä¸­ä½¿ç”¨åï¼Œå›¾åƒä¼šè¢«ç«‹å³åˆ é™¤ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡ä½¿ç”¨å†è¢«åˆ›å»ºã€‚\n1 2 3 4 5 6 # Loss gt_image = viewpoint_cam.original_image.cuda() + del viewpoint_cam Ll1 = l1_loss(image, gt_image) loss = (1.0 - opt.lambda_dssim) * Ll1 + opt.lambda_dssim * (1.0 - ssim(image, gt_image)) loss.backward() ç„¶è€Œï¼Œå¥‡æ€ªçš„æ˜¯ï¼Œå†…å­˜ä½¿ç”¨é‡åœ¨å¼€å§‹æ—¶ç¡®å®æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå›¾åƒä¼šæŒ‰ç…§é¢„æœŸé€ä¸ªåŠ è½½ã€‚ä½†æœ€åå´å¢åŠ åˆ°äº† 20GB ä»¥ä¸Šï¼Œä¹‹åä»æœªå‡å°‘è¿‡ã€‚æ‰€ä»¥æˆ‘æ„è¯†åˆ°çœŸæ­£çš„é—®é¢˜æ˜¯å†…å­˜æ³„æ¼ã€‚\nç¬¬äºŒä¸ªè¡¥ä¸ - å†…å­˜æ³„æ¼ä¿®å¤ è¿™é‡Œçš„å†…å­˜æ³„æ¼éå¸¸ä»¤äººå›°æƒ‘ã€‚æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œæˆ‘åœ¨ Python ä¸­ä½¿ç”¨ del æ¥åˆ é™¤å¯¹ Camera ç±»çš„å¼•ç”¨ï¼Œæ‰€æœ‰çš„å†…å­˜åº”è¯¥åŒæ—¶è¢«æ¸…é™¤ã€‚æˆ‘è¯•å›¾åˆ°å¤„å¯»æ‰¾åŸå› ï¼Œä½†åªå‘ç°å®ƒä¸ PyTorch æœ‰å…³ã€‚ç”±äºæ— æ³•æ·±å…¥ç ”ç©¶ CUDA å¼ é‡ï¼Œæˆ‘å¼€å§‹å°è¯•åœ¨ Python ä»£ç ä¸­çš„ del æ‰€æœ‰ç›¸å…³å†…å®¹ã€‚å¹¸è¿çš„æ˜¯ï¼Œå®ƒæˆåŠŸäº†ã€‚\nè¡¥ä¸å¯åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯ç»§ç»­æé«˜å›¾åƒåŠ è½½çš„æ•ˆç‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 diff --git a/scene/__init__.py b/scene/__init__.py --- a/scene/__init__.py +++ b/scene/__init__.py @@ -37,9 +37,6 @@ class Scene: self.loaded_iter = load_iteration print(\u0026#34;Loading trained model at iteration {}\u0026#34;.format(self.loaded_iter)) - self.train_cameras = {} - self.test_cameras = {} - if os.path.exists(os.path.join(args.source_path, \u0026#34;sparse\u0026#34;)): scene_info = sceneLoadTypeCallbacks[\u0026#34;Colmap\u0026#34;](args.source_path, args.images, args.eval) elif os.path.exists(os.path.join(args.source_path, \u0026#34;transforms_train.json\u0026#34;)): @@ -67,12 +64,8 @@ class Scene: random.shuffle(scene_info.test_cameras) # Multi-res consistent random shuffling self.cameras_extent = scene_info.nerf_normalization[\u0026#34;radius\u0026#34;] - - for resolution_scale in resolution_scales: - print(\u0026#34;Loading Training Cameras\u0026#34;) - self.train_cameras[resolution_scale] = cameraList_from_camInfos(scene_info.train_cameras, resolution_scale, args) - print(\u0026#34;Loading Test Cameras\u0026#34;) - self.test_cameras[resolution_scale] = cameraList_from_camInfos(scene_info.test_cameras, resolution_scale, args) + self.scene_info = scene_info + self.args = args if self.loaded_iter: self.gaussians.load_ply(os.path.join(self.model_path, @@ -87,7 +80,7 @@ class Scene: self.gaussians.save_ply(os.path.join(point_cloud_path, \u0026#34;point_cloud.ply\u0026#34;)) def getTrainCameras(self, scale=1.0): - return self.train_cameras[scale] + return cameraList_from_camInfos(self.scene_info.train_cameras, scale, self.args) def getTestCameras(self, scale=1.0): - return self.test_cameras[scale] \\ No newline at end of file + return cameraList_from_camInfos(self.scene_info.test_cameras, scale, self.args) \\ No newline at end of file diff --git a/scene/cameras.py b/scene/cameras.py --- a/scene/cameras.py +++ b/scene/cameras.py @@ -17,6 +17,7 @@ from utils.graphics_utils import getWorld2View2, getProjectionMatrix class Camera(nn.Module): def __init__(self, colmap_id, R, T, FoVx, FoVy, image, gt_alpha_mask, image_name, uid, + raw_image=None, trans=np.array([0.0, 0.0, 0.0]), scale=1.0, data_device = \u0026#34;cuda\u0026#34; ): super(Camera, self).__init__() @@ -29,6 +30,14 @@ class Camera(nn.Module): self.FoVy = FoVy self.image_name = image_name + if raw_image is not None: + image = raw_image[:3, ...] + gt_alpha_mask = None + + if raw_image.shape[1] == 4: + gt_alpha_mask = raw_image[3:4, ...] + del raw_image + try: self.data_device = torch.device(data_device) except Exception as e: @@ -39,9 +48,11 @@ class Camera(nn.Module): self.original_image = image.clamp(0.0, 1.0).to(self.data_device) self.image_width = self.original_image.shape[2] self.image_height = self.original_image.shape[1] + del image if gt_alpha_mask is not None: self.original_image *= gt_alpha_mask.to(self.data_device) + del gt_alpha_mask else: self.original_image *= torch.ones((1, self.image_height, self.image_width), device=self.data_device) @@ -56,6 +67,9 @@ class Camera(nn.Module): self.full_proj_transform = (self.world_view_transform.unsqueeze(0).bmm(self.projection_matrix.unsqueeze(0))).squeeze(0) self.camera_center = self.world_view_transform.inverse()[3, :3] + def __del__(self): + del self.original_image, self.world_view_transform, self.projection_matrix, self.full_proj_transform, self.camera_center + class MiniCam: def __init__(self, width, height, fovy, fovx, znear, zfar, world_view_transform, full_proj_transform): self.image_width = width diff --git a/train.py b/train.py --- a/train.py +++ b/train.py @@ -44,103 +43,82 @@ def training(dataset, opt, pipe, testing_iterations, saving_iterations, checkpoi iter_start = torch.cuda.Event(enable_timing = True) iter_end = torch.cuda.Event(enable_timing = True) - viewpoint_stack = None + viewpoint_stack = scene.getTrainCameras() ema_loss_for_log = 0.0 progress_bar = tqdm(range(first_iter, opt.iterations), desc=\u0026#34;Training progress\u0026#34;) first_iter += 1 ç¬¬äºŒéƒ¨åˆ†æ˜¯åœ¨ä¸»è®­ç»ƒå¾ªç¯ä¸­ä½¿ç”¨ delã€‚å› ä¸ºæˆ‘å¯¹è®­ç»ƒè¿‡ç¨‹åšäº†å…¶ä»–ä¿®æ”¹ï¼Œå› æ­¤æ— æ³•åœ¨æ­¤ç»™å‡ºå®Œæ•´çš„è¡¥ä¸ã€‚ç¼©å‡ç‰ˆå¦‚ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 for iteration in range(first_iter, opt.iterations + 1): iter_start.record() gaussians.update_learning_rate(iteration) # Every 1000 its we increase the levels of SH up to a maximum degree if iteration % 1000 == 0: gaussians.oneupSHdegree() # Pick a random Camera if len(viewpoint_stack)==0: del viewpoint_stack viewpoint_stack = scene.getTrainCameras() viewpoint_cam = viewpoint_stack.pop(randint(0, len(viewpoint_stack)-1)) # Render if (iteration - 1) == debug_from: pipe.debug = True bg = torch.rand((3), device=\u0026#34;cuda\u0026#34;) if opt.random_background else background render_pkg = render(viewpoint_cam, gaussians, pipe, bg) image, viewspace_point_tensor, visibility_filter, radii = render_pkg[\u0026#34;render\u0026#34;], render_pkg[\u0026#34;viewspace_points\u0026#34;], render_pkg[\u0026#34;visibility_filter\u0026#34;], render_pkg[\u0026#34;radii\u0026#34;] # Loss gt_image = viewpoint_cam.original_image.cuda() Ll1 = l1_loss(image, gt_image) loss = (1.0 - opt.lambda_dssim) * Ll1 + opt.lambda_dssim * (1.0 - ssim(image, gt_image)) loss.backward() iter_end.record() with torch.no_grad(): # Progress bar ema_loss_for_log = 0.4 * loss.item() + 0.6 * ema_loss_for_log if iteration % 10 == 0: progress_bar.set_postfix({\u0026#34;Loss\u0026#34;: f\u0026#34;{ema_loss_for_log:.{7}f}\u0026#34;}) progress_bar.update(10) if iteration == opt.iterations: progress_bar.close() # Log and save torch.cuda.empty_cache() if (iteration in saving_iterations): print(\u0026#34;\\n[ITER {}] Saving Gaussians\u0026#34;.format(iteration)) scene.save(iteration) # Densification if iteration \u0026lt; opt.densify_until_iter: # Keep track of max radii in image-space for pruning gaussians.max_radii2D[visibility_filter] = torch.max(gaussians.max_radii2D[visibility_filter], radii[visibility_filter]) gaussians.add_densification_stats(viewspace_point_tensor, visibility_filter) if iteration \u0026gt; opt.densify_from_iter and iteration % opt.densification_interval == 0: size_threshold = 20 if iteration \u0026gt; opt.opacity_reset_interval else None gaussians.densify_and_prune(opt.densify_grad_threshold, 0.005, scene.cameras_extent, size_threshold) if iteration % opt.opacity_reset_interval == 0 or (dataset.white_background and iteration == opt.densify_from_iter): gaussians.reset_opacity() # Optimizer step if iteration \u0026lt; opt.iterations: gaussians.optimizer.step() gaussians.optimizer.zero_grad(set_to_none = True) if (iteration in checkpoint_iterations): print(\u0026#34;\\n[ITER {}] Saving Checkpoint\u0026#34;.format(iteration)) torch.save((gaussians.capture(), iteration), scene.model_path + \u0026#34;/chkpnt\u0026#34; + str(iteration) + \u0026#34;.pth\u0026#34;) del viewpoint_cam, image, viewspace_point_tensor, visibility_filter, radii, gt_image, Ll1, loss, render_pkg åœ¨æ‰“äº†ä¸¤ä¸ªè¡¥ä¸ä¹‹åï¼Œå†…å­˜ä½¿ç”¨é‡ç»ˆäºå¾—åˆ°äº†æ§åˆ¶ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼ŒGPU å†…å­˜ä½¿ç”¨é‡å¯ä»¥æ§åˆ¶åœ¨ 10GB ä»¥ä¸‹ã€‚\nç»“è®º æˆ‘ä¸ç¡®å®šæ˜¯å¦åº”è¯¥å‘åŸå§‹ç‰ˆæœ¬åº“æŠ¥å‘Šè¿™ä¸ªé—®é¢˜ã€‚å› ä¸ºåœ¨è¿‡å»çš„ä¸€å¹´é‡Œï¼Œäººä»¬å¹¶æ²¡æœ‰æ„è¯†åˆ°å†…å­˜æ³„æ¼é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä¸ç¡®å®šè¿™æ˜¯å¦æ˜¯ä¸€ä¸ªæ™®éé—®é¢˜ï¼Œæˆ–è€…åªæ˜¯æˆ‘çš„æƒ…å†µã€‚æ€»ä¹‹ï¼Œæˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©æ­£åœ¨ä¸ºåŒæ ·é—®é¢˜è€Œè‹¦æ¼çš„äººã€‚\n","date":"2024-09-02T15:43:01+08:00","image":"https://sudofree.xyz/p/solve-memory-leak-in-vanilla-gaussian-splatting-code/memory-leak_hu14931053131067599422.png","permalink":"https://sudofree.xyz/p/solve-memory-leak-in-vanilla-gaussian-splatting-code/","title":"è§£å†³ Gaussian Splatting åŸå§‹å®ç°ä¸­çš„å†…å­˜æ³„æ¼é—®é¢˜"},{"content":"WIP \u0026hellip;\n","date":"2024-08-30T19:41:50+08:00","permalink":"https://sudofree.xyz/p/distributed-native-application/","title":"Distributed Native Application"}]